@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

actor User
participant "VkbApiClient" as VKB
participant "CollectiveKnowledge\nSystem" as CK
participant "GraphDatabaseService" as GDS
participant "GraphDatabaseAdapter" as GDA
participant "PersistenceAgent" as PA
participant "GraphKnowledgeExporter" as GKE
database "Graphology + LevelDB\n(.data/knowledge-graph)" as DB
database "JSON Export\n(.data/knowledge-export)" as Export

User -> VKB: Execute vkb command
activate VKB

VKB -> CK: Request knowledge operation
activate CK

CK -> GDS: Process knowledge management
activate GDS

GDS -> GDA: Database operation request
activate GDA

GDA -> PA: Persistence operation
activate PA

PA -> DB: Store/Retrieve data
activate DB
DB --> PA: Data response
deactivate DB

PA --> GDA: Operation result
deactivate PA

GDA --> GDS: Database response
deactivate GDA

alt Knowledge Export Required
    GDS -> GKE: Trigger export
    activate GKE
    
    GKE -> DB: Read knowledge graph
    activate DB
    DB --> GKE: Graph data
    deactivate DB
    
    GKE -> Export: Write JSON export
    activate Export
    Export --> GKE: Export complete
    deactivate Export
    
    GKE --> GDS: Export synchronized
    deactivate GKE
end

GDS --> CK: Knowledge operation complete
deactivate GDS

CK --> VKB: Response
deactivate CK

VKB --> User: Operation result
deactivate VKB

note over DB, Export
Hybrid Storage Architecture:
- Primary: Graphology + LevelDB
- Secondary: Automated JSON exports
- Synchronized for external access
end note

note over GDS, GKE
Core Components:
- GraphDatabaseService
- GraphDatabaseAdapter  
- PersistenceAgent
- GraphKnowledgeExporter
end note

@enduml