@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant CollectiveKnowledge as "CollectiveKnowledge System"
participant GraphDatabaseService as "Graph Database Service"
participant GraphKnowledgeExporter as "Graph Knowledge Exporter"
participant GraphDatabaseAdapter as "Graph Database Adapter"
participant PersistenceAgent as "Persistence Agent"
participant VkbApiClient as "VKB API Client"
participant User as "User"

activate CollectiveKnowledge
note over CollectiveKnowledge: Hybrid storage architecture: Graphology and LevelDB at .data/knowledge-graph
note over CollectiveKnowledge: Automated JSON exports to .data/knowledge-export

User->>CollectiveKnowledge: Request knowledge management operation
CollectiveKnowledge->>GraphDatabaseService: Manage knowledge graph
GraphDatabaseService->>GraphDatabaseAdapter: Interact with graph database
GraphDatabaseAdapter->>GraphDatabaseService: Provide graph data
GraphDatabaseService->>GraphKnowledgeExporter: Export knowledge graph
GraphKnowledgeExporter->>CollectiveKnowledge: Exported knowledge graph

alt Successful export
    CollectiveKnowledge->>User: Return exported knowledge graph
else Export failed
    CollectiveKnowledge->>User: Return error message
end

loop Data synchronization
    CollectiveKnowledge->>GraphDatabaseService: Synchronize data using graph-sync
    GraphDatabaseService->>GraphDatabaseAdapter: Synchronize graph data
    GraphDatabaseAdapter->>GraphDatabaseService: Confirm synchronization
end

User->>CollectiveKnowledge: Visualize knowledge graph using vkb
CollectiveKnowledge->>VkbApiClient: Request visualization
VkbApiClient->>CollectiveKnowledge: Return visualization

User->>CollectiveKnowledge: Perform knowledge operation using MCP tools
CollectiveKnowledge->>PersistenceAgent: Manage knowledge operation
PersistenceAgent->>CollectiveKnowledge: Confirm operation

deactivate CollectiveKnowledge

@enduml