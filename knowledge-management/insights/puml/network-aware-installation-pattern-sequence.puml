@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "MCPAgent" as MCP
participant "NetworkAwareInstallationPattern" as NAIP
participant "KnowledgeManager" as KM
participant "GraphologyEngine" as GE
participant "LevelDB" as LDB
participant "SemanticAnalyzer" as SA
participant "JSONExporter" as JE

activate MCP
MCP -> NAIP: initialize()
activate NAIP

NAIP -> KM: setupKnowledgeStorage()
activate KM

KM -> GE: initializeGraphology()
activate GE
GE -> LDB: connect(.data/knowledge-graph)
activate LDB
LDB --> GE: connection established
GE --> KM: graph engine ready
deactivate GE

KM --> NAIP: storage initialized
deactivate KM

NAIP -> SA: analyzeCodebase()
activate SA

loop codebase analysis
    SA -> SA: extractPatterns(src/knowledge-management)
    SA -> SA: extractPatterns(lib/ukb-unified)
    SA -> SA: extractPatterns(integrations/mcp-server-semantic-analysis/src)
end

SA -> KM: storePattern(NetworkAwareInstallationPattern)
activate KM
KM -> GE: addNode(pattern)
activate GE
GE -> LDB: persist(pattern)
LDB --> GE: stored
GE --> KM: pattern added
deactivate GE
KM --> SA: pattern stored
deactivate KM

SA --> NAIP: analysis complete
deactivate SA

NAIP -> JE: exportKnowledge()
activate JE
JE -> KM: getKnowledgeGraph()
activate KM
KM -> GE: exportGraph()
activate GE
GE -> LDB: queryAll()
LDB --> GE: graph data
GE --> KM: serialized graph
deactivate GE
KM --> JE: knowledge data
deactivate KM

JE -> JE: syncToJSON(.data/knowledge-export)
JE --> NAIP: export complete
deactivate JE

note right of LDB: shared-memory.json REMOVED\nUsing LevelDB for persistence

NAIP --> MCP: pattern installation ready
deactivate NAIP
deactivate LDB
deactivate MCP

@enduml