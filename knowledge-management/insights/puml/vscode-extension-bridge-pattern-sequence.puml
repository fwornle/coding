@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "VSCode Extension" as VSCode
participant "Knowledge Management\n(src/knowledge-management)" as KM
participant "UKB Unified\n(lib/ukb-unified)" as UKB
participant "MCP Semantic Server\n(integrations/mcp-server-semantic-analysis)" as MCP
participant "GraphDatabaseService" as GraphDB
participant "GraphDatabaseAdapter" as Adapter
participant "PersistenceAgent" as Persistence
database "Graphology + LevelDB\n(.data/knowledge-graph)" as Storage
database "JSON Export\n(.data/knowledge-export)" as Export

VSCode -> KM: Initialize VSCodeExtensionBridgePattern
activate KM

KM -> UKB: Setup unified knowledge base
activate UKB

UKB -> GraphDB: Initialize graph database service
activate GraphDB

GraphDB -> Adapter: Create database adapter
activate Adapter

Adapter -> Storage: Connect to Graphology + LevelDB
activate Storage

note over Storage: Primary storage at\n.data/knowledge-graph

GraphDB -> Persistence: Initialize persistence agent
activate Persistence

VSCode -> MCP: Request semantic analysis
activate MCP

MCP -> GraphDB: Query knowledge entities
GraphDB -> Adapter: Execute graph query
Adapter -> Storage: Retrieve data
Storage --> Adapter: Return graph data
Adapter --> GraphDB: Formatted results
GraphDB --> MCP: Knowledge entities

alt Pattern Storage
    MCP -> GraphDB: Store VSCodeExtensionBridgePattern
    GraphDB -> Adapter: Persist pattern entity
    Adapter -> Storage: Store in graph database
    
    GraphDB -> Persistence: Trigger auto-sync
    Persistence -> Export: Export JSON representation
    activate Export
    note over Export: Auto-synced JSON exports\nat .data/knowledge-export
end

note over KM, MCP: shared-memory.json REMOVED\nfrom codebase - using GraphDB instead

VSCode -> KM: Access pattern knowledge
KM -> UKB: Query bridge pattern
UKB -> GraphDB: Retrieve pattern components
GraphDB -> Storage: Fetch pattern data
Storage --> GraphDB: Pattern architecture
GraphDB --> UKB: Component relationships
UKB --> KM: Structured knowledge
KM --> VSCode: Bridge pattern implementation

@enduml