@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "VSCode Extension" as VSCode
participant "Bridge Pattern\nController" as Bridge
participant "GraphDatabaseService" as GraphService
participant "GraphDatabaseAdapter" as Adapter
participant "PersistenceAgent" as Persistence
participant "Graphology\n+ LevelDB" as Storage
participant "Knowledge Export\n(.data/knowledge-export)" as Export

VSCode -> Bridge: Initialize knowledge management
activate Bridge

Bridge -> GraphService: setupGraphDatabase()
activate GraphService

GraphService -> Adapter: createAdapter()
activate Adapter

Adapter -> Storage: connect(.data/knowledge-graph)
activate Storage
Storage --> Adapter: connection established
deactivate Storage

Adapter --> GraphService: adapter ready
deactivate Adapter

GraphService -> Persistence: initializePersistenceAgent()
activate Persistence

Persistence -> Storage: validateStorage()
activate Storage
Storage --> Persistence: storage validated
deactivate Storage

Persistence --> GraphService: persistence ready
deactivate Persistence

GraphService --> Bridge: graph database ready
deactivate GraphService

Bridge --> VSCode: bridge pattern initialized
deactivate Bridge

note over VSCode, Export: Knowledge Management Flow

VSCode -> Bridge: storeKnowledgeEntity(pattern)
activate Bridge

Bridge -> GraphService: persistEntity(VSCodeExtensionBridgePattern)
activate GraphService

GraphService -> Adapter: writeToGraph(entity)
activate Adapter

Adapter -> Storage: store(entity, relationships)
activate Storage
Storage --> Adapter: stored successfully
deactivate Storage

Adapter --> GraphService: entity persisted
deactivate Adapter

GraphService -> Persistence: syncToExport()
activate Persistence

Persistence -> Export: exportToJSON(entity)
activate Export
Export --> Persistence: export completed
deactivate Export

Persistence --> GraphService: sync completed
deactivate Persistence

GraphService --> Bridge: knowledge stored
deactivate GraphService

Bridge --> VSCode: pattern stored successfully
deactivate Bridge

note over Storage: Removed: shared-memory.json\nUsing: Graphology + LevelDB
note over Export: Auto-synced JSON exports\nfor external access

@enduml