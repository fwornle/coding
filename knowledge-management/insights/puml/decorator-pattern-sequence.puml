@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "Knowledge Management\n(src/knowledge-management)" as KM
participant "UKB Unified\n(lib/ukb-unified)" as UKB
participant "MCP Server\n(integrations/mcp-server-semantic-analysis)" as MCP
participant "Graphology Engine" as Graph
participant "LevelDB Storage\n(.data/knowledge-graph)" as LevelDB
participant "JSON Export\n(.data/knowledge-export)" as JSONExport

note over KM, JSONExport : DecoratorPattern Implementation in GraphDatabase Architecture

KM -> UKB : Initialize DecoratorPattern entity
activate UKB

UKB -> Graph : Create pattern node
activate Graph

Graph -> LevelDB : Store pattern metadata
activate LevelDB
LevelDB --> Graph : Confirm storage
deactivate LevelDB

Graph --> UKB : Pattern node created
deactivate Graph

UKB -> MCP : Register for semantic analysis
activate MCP

MCP -> MCP : Analyze DecoratorPattern\nacross modules
MCP -> Graph : Update pattern relationships
activate Graph

Graph -> LevelDB : Persist relationship data
activate LevelDB
LevelDB --> Graph : Data persisted
deactivate LevelDB

Graph --> MCP : Relationships updated
deactivate Graph

opt Auto-sync enabled
    Graph -> JSONExport : Export pattern data
    activate JSONExport
    JSONExport -> JSONExport : Generate JSON representation
    JSONExport --> Graph : Export complete
    deactivate JSONExport
end

MCP --> UKB : Semantic analysis complete
deactivate MCP

UKB --> KM : DecoratorPattern entity ready
deactivate UKB

note right of LevelDB : Primary storage:\nGraphology + LevelDB
note right of JSONExport : Auto-synced from GraphDB\n(shared-memory.json removed)

@enduml