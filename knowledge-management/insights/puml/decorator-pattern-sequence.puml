@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant GraphDatabaseService as "Graph Database Service"
participant GraphDatabaseAdapter as "Graph Database Adapter"
participant MCPAgent as "MCP Agent"
participant Graphology as "Graphology"
participant LevelDB as "LevelDB"
participant vkb as "VKB Command"
participant "Graph-Sync Command" as graph-sync
participant KnowledgeGraph as "Knowledge Graph"

MCPAgent->>GraphDatabaseService: Request Knowledge Graph Data
GraphDatabaseService->>GraphDatabaseAdapter: Query Knowledge Graph
GraphDatabaseAdapter->>Graphology: Use Graphology for Storage
Graphology->>LevelDB: Store Data in LevelDB
LevelDB->>Graphology: Retrieve Data from LevelDB
Graphology->>GraphDatabaseAdapter: Return Data to Adapter
GraphDatabaseAdapter->>GraphDatabaseService: Return Knowledge Graph Data
GraphDatabaseService->>MCPAgent: Return Knowledge Graph Data

alt Sync Knowledge Graph
    graph-sync->>GraphDatabaseService: Sync Knowledge Graph
    GraphDatabaseService->>GraphDatabaseAdapter: Update Knowledge Graph
    GraphDatabaseAdapter->>Graphology: Update Graphology Storage
    Graphology->>LevelDB: Update LevelDB Storage
    LevelDB->>Graphology: Confirm Update
    Graphology->>GraphDatabaseAdapter: Confirm Update
    GraphDatabaseAdapter->>GraphDatabaseService: Confirm Update
    GraphDatabaseService->>graph-sync: Confirm Sync
end

opt Visualize Knowledge Graph
    vkb->>GraphDatabaseService: Request Knowledge Graph Visualization
    GraphDatabaseService->>GraphDatabaseAdapter: Query Knowledge Graph for Visualization
    GraphDatabaseAdapter->>Graphology: Use Graphology for Visualization
    Graphology->>vkb: Return Visualization Data
    vkb->>MCPAgent: Display Knowledge Graph Visualization
end

@enduml