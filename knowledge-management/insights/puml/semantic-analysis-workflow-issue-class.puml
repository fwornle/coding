@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

package "Knowledge Management" {
    class SemanticAnalysisWorkflowIssue <<entity>> {
        -workflowId: string
        -issueType: string
        -semanticContext: Map
        -analysisResults: AnalysisResult[]
        +analyzeWorkflow(): void
        +identifyIssues(): Issue[]
        +generateRecommendations(): string[]
    }
    
    class KnowledgeGraphManager <<service>> {
        -graphologyInstance: Graphology
        -levelDbAdapter: LevelDB
        +storeEntity(entity: any): void
        +queryGraph(query: string): any[]
        +updateRelationships(): void
        +exportToJson(): void
    }
    
    class SemanticAnalyzer <<service>> {
        -nlpProcessor: NLPProcessor
        -contextExtractor: ContextExtractor
        +processWorkflow(workflow: Workflow): AnalysisResult
        +extractSemantics(content: string): SemanticData
        +identifyPatterns(): Pattern[]
    }
}

package "UKB Unified Library" {
    abstract class BaseWorkflowProcessor {
        #workflowData: WorkflowData
        #analysisConfig: Config
        +{abstract} process(): ProcessResult
        +{abstract} validate(): boolean
    }
    
    class WorkflowIssueProcessor extends BaseWorkflowProcessor {
        -issueDetectionRules: Rule[]
        -semanticMatcher: SemanticMatcher
        +process(): ProcessResult
        +validate(): boolean
        +detectSemanticIssues(): Issue[]
    }
    
    interface ISemanticProvider {
        +provideSemantics(input: string): SemanticData
        +updateContext(context: Context): void
    }
    
    class UnifiedSemanticProvider implements ISemanticProvider {
        -providers: SemanticProvider[]
        -aggregator: ResultAggregator
        +provideSemantics(input: string): SemanticData
        +updateContext(context: Context): void
        +aggregateResults(): AggregatedResult
    }
}

package "MCP Server Integration" {
    class MCPSemanticAnalysisServer <<service>> {
        -serverInstance: MCPServer
        -analysisHandlers: Handler[]
        +startServer(): void
        +handleAnalysisRequest(request: Request): Response
        +registerHandlers(): void
    }
    
    class SemanticAnalysisHandler <<handler>> {
        -workflowProcessor: WorkflowIssueProcessor
        -responseFormatter: ResponseFormatter
        +handleRequest(request: AnalysisRequest): AnalysisResponse
        +formatResponse(result: ProcessResult): Response
    }
}

package "Data Storage" {
    class GraphDatabase <<database>> {
        -graphologyEngine: Graphology
        -persistenceLayer: LevelDB
        -dataPath: string = ".data/knowledge-graph"
        +connect(): void
        +store(data: GraphData): void
        +query(cypher: string): ResultSet
        +exportSnapshot(): void
    }
    
    class JSONExporter <<service>> {
        -exportPath: string = ".data/knowledge-export"
        -syncScheduler: Scheduler
        +exportFromGraph(graph: GraphData): void
        +scheduleAutoSync(): void
        +syncToFileSystem(): void
    }
    
    class LevelDBAdapter <<adapter>> {
        -dbInstance: LevelDB
        -serializer: DataSerializer
        +put(key: string, value: any): void
        +get(key: string): any
        +batch(operations: Operation[]): void
    }
}

package "Core Models" {
    class Workflow {
        -id: string
        -steps: WorkflowStep[]
        -metadata: Metadata
        +execute(): ExecutionResult
        +validate(): ValidationResult
    }
    
    class AnalysisResult {
        -workflowId: string
        -issues: Issue[]
        -recommendations: Recommendation[]
        -confidence: number
        +toJson(): string
        +merge(other: AnalysisResult): AnalysisResult
    }
    
    enum IssueType {
        SEMANTIC_AMBIGUITY
        WORKFLOW_INCONSISTENCY
        CONTEXT_MISMATCH
        DEPENDENCY_CONFLICT
    }
}

' Relationships
SemanticAnalysisWorkflowIssue --> KnowledgeGraphManager : uses
SemanticAnalysisWorkflowIssue --> SemanticAnalyzer : analyzes_with
SemanticAnalysisWorkflowIssue --> AnalysisResult : produces
SemanticAnalysisWorkflowIssue --> IssueType : categorizes

WorkflowIssueProcessor --> SemanticAnalysisWorkflowIssue : processes
UnifiedSemanticProvider --> SemanticAnalyzer : provides_to

MCPSemanticAnalysisServer --> SemanticAnalysisHandler : contains
SemanticAnalysisHandler --> WorkflowIssueProcessor : delegates_to

KnowledgeGraphManager --> GraphDatabase : manages
GraphDatabase --> LevelDBAdapter : persists_with
GraphDatabase --> JSONExporter : exports_via
JSONExporter ..> GraphDatabase : auto_sync

SemanticAnalyzer --> Workflow : analyzes
AnalysisResult --> IssueType : contains

note right of GraphDatabase : "Replaces shared-memory.json\nwith persistent graph storage"

note bottom of JSONExporter : "Auto-synced exports for\nbackward compatibility"

@enduml