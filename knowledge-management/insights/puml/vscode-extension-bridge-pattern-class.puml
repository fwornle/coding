@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

package "src/knowledge-management" {
    class KnowledgeManager <<service>> {
        -graphDatabaseService: GraphDatabaseService
        -persistenceAgent: PersistenceAgent
        +storeKnowledgeEntity(entity: Object)
        +retrieveEntity(id: String)
        +exportToJSON()
    }
    
    class PersistenceAgent <<service>> {
        -adapter: GraphDatabaseAdapter
        +persist(data: Object)
        +load(query: String)
        +syncToExport()
    }
}

package "lib/ukb-unified" {
    abstract class GraphDatabaseAdapter {
        #connectionString: String
        +abstract connect()
        +abstract query(sql: String)
        +abstract store(entity: Object)
    }
    
    class GraphologyLevelDBAdapter {
        -graphology: GraphologyInstance
        -levelDB: LevelDBInstance
        -storagePath: String
        +connect()
        +query(sql: String)
        +store(entity: Object)
        +createIndex(field: String)
    }
    
    interface GraphDatabaseService <<interface>> {
        +executeQuery(query: String)
        +storeEntity(entity: Object)
        +createRelationship(from: String, to: String, type: String)
    }
}

package "integrations/mcp-server-semantic-analysis/src" {
    class SemanticAnalysisService <<service>> {
        -knowledgeManager: KnowledgeManager
        +analyzeCodebase()
        +extractPatterns()
        +storeAnalysisResults()
    }
    
    class VSCodeExtensionBridgePattern <<entity>> {
        -patternId: String
        -components: List<String>
        -implementationPaths: List<String>
        -extractedFrom: String
        +getArchitecturalComponents()
        +getImplementationDetails()
    }
}

package "Storage Layer" {
    class GraphologyStorage <<file>> {
        -path: ".data/knowledge-graph"
        -format: "LevelDB"
        +read()
        +write()
        +backup()
    }
    
    class JSONExportStorage <<file>> {
        -path: ".data/knowledge-export"
        -autoSync: Boolean
        +exportFromGraph()
        +syncWithGraphDB()
    }
}

' Relationships
KnowledgeManager --> PersistenceAgent : uses
PersistenceAgent --> GraphDatabaseAdapter : delegates to
GraphologyLevelDBAdapter --|> GraphDatabaseAdapter : implements
GraphologyLevelDBAdapter ..|> GraphDatabaseService : implements
SemanticAnalysisService --> KnowledgeManager : uses
SemanticAnalysisService --> VSCodeExtensionBridgePattern : creates
GraphologyLevelDBAdapter --> GraphologyStorage : stores to
PersistenceAgent --> JSONExportStorage : exports to
JSONExportStorage ..> GraphologyStorage : syncs from

' Notes
note right of VSCodeExtensionBridgePattern : "Pattern extracted from codebase\nanalysis across multiple modules"
note bottom of GraphologyStorage : "Replaced shared-memory.json\nwith persistent graph storage"
note bottom of JSONExportStorage : "Auto-synced exports\nfor external consumption"

@enduml