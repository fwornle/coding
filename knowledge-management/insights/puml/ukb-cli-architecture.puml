@startuml ukb-cli-architecture
!theme plain
skinparam backgroundColor white
skinparam roundcorner 20
skinparam shadowing false
title UkbCli - Modern Knowledge Management CLI Architecture

skinparam component {
  BackgroundColor #E8F5E8
  FontSize 11
  FontColor #000000
}
skinparam package {
  BackgroundColor #F8F8F8
  BorderColor #888888
  FontSize 12
  FontColor #000000
}
skinparam note {
  BackgroundColor #FFFACD
  FontSize 9
  FontColor #000000
}
skinparam arrow {
  FontSize 9
  FontColor #000000
}

package "UkbCli System" {
  
  package "CLI Layer" {
    [CLI Entry Point] as cli
    [Argument Parser] as parser
    [Command Router] as router
  }
  
  package "Core Services" {
    [Knowledge Manager] as km
    [Git Analyzer] as git
    [Insight Extractor] as extractor
    [Content Validator] as validator
  }
  
  package "Input/Output" {
    [Interactive Prompts] as prompts
    [File I/O Handler] as fileio
    [JSON Processor] as json
    [Error Handler] as error
  }
  
  package "Validation Layer" {
    [URL Validator] as urlval
    [Content Filter] as filter
    [Schema Validator] as schema
  }
}

package "External Systems" {
  database "shared-memory.json" as memory
  cloud "MCP Memory Server" as mcp
  [Git Repository] as gitrepo
  [VKB Visualizer] as vkb
}

package "Legacy System" {
  [UKB Bash Script] as ukb_legacy
}

' CLI Flow
cli --> parser
parser --> router
router --> km

' Core Service Interactions
km --> git
km --> extractor
km --> validator
km --> prompts
km --> fileio

' Validation Flow
validator --> urlval
validator --> filter
validator --> schema

' Data Flow
fileio --> json
json --> memory
km --> mcp
memory --> vkb

' Git Integration
git --> gitrepo

' Error Handling
error --> cli
km --> error
validator --> error

' Legacy Integration
ukb_legacy ..> cli : "executes via\nnode ukb-cli"

note right of km
  **Core Responsibilities:**
  - Entity management
  - Relationship handling
  - Insight capture
  - Cross-session persistence
end note

note right of validator
  **Content Quality:**
  - Marketing language filter
  - URL validation
  - Schema compliance
  - Technical content verification
end note

note bottom of memory
  **Data Format:**
  - Entities with structured observations
  - Relations with types
  - Metadata tracking
  - Enhanced schema support
end note

@enduml