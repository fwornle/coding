@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

package "ConfigurationPattern" {
    class ConfigurationPattern <<MCPAgent>> {
        +initialize()
        +validate()
        +synchronize()
    }
}

package "Knowledge Management" {
    class GraphDatabaseService {
        -storage: LevelDB
        -graphEngine: Graphology
        +query()
        +store()
        +sync()
    }
    
    class GraphKnowledgeExporter {
        -exportPath: String
        +exportToJson()
        +autoSync()
    }
    
    class GraphDatabaseAdapter {
        +ensureConsistency()
        +getConnection()
        +executeQuery()
    }
}

package "UKB Unified" {
    class VkbApiClient {
        +executeVkbCommand()
        +visualizeGraph()
    }
    
    class PersistenceAgent {
        +saveState()
        +loadState()
        +manageTransactions()
    }
}

package "MCP Server Integration" {
    class McpServerSemanticAnalysis {
        -port: Integer
        -gitSubmodule: String
        +handleRaceConditions()
        +processStatusOperations()
    }
    
    class CodeGraphRag {
        +analyzeCode()
        +buildGraph()
        +provideContext()
    }
}

package "Configuration Management" {
    class EnvironmentConfig {
        -envPortsFile: String
        +loadEnvironmentVars()
        +validatePorts()
    }
    
    class CommandProcessor {
        +executeVkbCommand()
        +executeCodingCommand()
        +executeGraphSync()
    }
}

package "Data Storage" {
    class LevelDBStorage <<file>> {
        +read()
        +write()
        +compact()
    }
    
    class JsonExporter <<file>> {
        -exportPath: ".data/knowledge-export"
        +exportData()
        +ensureInteroperability()
    }
}

' Relationships
ConfigurationPattern --> GraphDatabaseService
ConfigurationPattern --> EnvironmentConfig
ConfigurationPattern --> McpServerSemanticAnalysis

GraphDatabaseService --> LevelDBStorage
GraphDatabaseService --> GraphDatabaseAdapter
GraphKnowledgeExporter --> JsonExporter
GraphDatabaseService --> GraphKnowledgeExporter

VkbApiClient --> CommandProcessor
PersistenceAgent --> LevelDBStorage

McpServerSemanticAnalysis --> CodeGraphRag
McpServerSemanticAnalysis --> EnvironmentConfig

CommandProcessor ..> VkbApiClient
GraphDatabaseAdapter ..> GraphDatabaseService

' Notes
note right of GraphDatabaseService : Uses Graphology + LevelDB\nat .data/knowledge-graph
note right of McpServerSemanticAnalysis : Git submodules for\ncode-graph-rag functionality
note right of EnvironmentConfig : Replaces deprecated\nshared-memory.json
note right of JsonExporter : Auto-synchronized exports\nfor interoperability

@enduml