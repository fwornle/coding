@startuml mcp-integration-compact
!theme plain
skinparam backgroundColor white
skinparam defaultFontSize 10
skinparam maxMessageSize 40

title Knowledge Management System - Compact Architecture

top to bottom direction

package "Claude Code with Auto-Logging" as ClaudeEnv {
    [claude-mcp] as CLI
    [start-auto-logger.sh] as Logger
    [Claude CLI] as Claude
    [MCP Framework] as MCP
}

package "MCP Servers" as Servers {
    [Browser Server] as Browser  
    [Memory Server] as Memory
}

package "Knowledge System" as KnowledgeSystem {
    [UKB Command] as UKB
    [VKB Server] as VKB
    [shared-memory.json] as SharedMem
}

package "Data Storage" as Storage {
    [.specstory/] as SpecStory
    [insights/] as Insights
    [Git Repository] as Git
}

' I/O Interception Flow
CLI --> Logger : launches
Logger --> Claude : I/O interception
Claude <--> MCP : stdio transport

' MCP Connections
MCP <--> Browser : web automation
MCP <--> Memory : graph operations

' Logging Flow
Logger --> SpecStory : smart routing\n(coding vs project)
Browser --> UKB : URL validation
Memory <--> SharedMem : persistence

' Knowledge Flow
UKB --> SharedMem : updates
VKB --> SharedMem : visualization
UKB --> Insights : documentation
SharedMem --> Git : version control

actor Developer as Dev
Dev --> CLI : claude-mcp
Dev --> UKB : insight capture
Dev --> VKB : knowledge exploration

note right of Logger : I/O stream interception\nfor automatic logging\nwith smart content routing

@enduml