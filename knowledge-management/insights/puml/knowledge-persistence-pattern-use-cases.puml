@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

title Knowledge Persistence Pattern - Use Cases

actor "Developer" as dev
actor "System" as sys
actor "Knowledge Manager" as km
actor "MCP Server" as mcp

package "Knowledge Management" {
  usecase "Store Knowledge Entity" as store
  usecase "Export to JSON" as export
  usecase "Query Knowledge Graph" as query
  usecase "Persist to LevelDB" as persist
  usecase "Load from GraphDB" as load
  usecase "Sync Data" as sync
}

package "Graph Database Operations" {
  usecase "Maintain In-Memory Graph" as memory
  usecase "Handle Entity Events" as events
  usecase "Auto-Export on Storage" as autoexport
}

package "File System Operations" {
  usecase "Write to .data/knowledge-graph" as writedb
  usecase "Write to .data/knowledge-export" as writejson
  usecase "Remove shared-memory.json" as cleanup
}

dev --> store : creates knowledge
dev --> query : retrieves data
km --> export : manual export
sys --> events : triggers entity:stored
mcp --> load : semantic analysis

store --> persist : includes
store --> events : triggers
events --> autoexport : includes
autoexport --> export : extends
export --> writejson : includes
persist --> writedb : includes
memory --> persist : includes
query --> memory : includes
load --> memory : includes
sync --> export : includes

note right of autoexport : Listens to entity:stored events
note bottom of writedb : Graphology + LevelDB storage
note bottom of writejson : Auto-synced from GraphDB
note top of cleanup : Legacy file removed from codebase

@enduml