@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "API Client" as client
participant "Legacy API" as legacy
participant "Refactoring Engine" as engine
participant "New API" as newapi
participant "Pattern Analyzer" as analyzer

client -> legacy: Initial API Request
activate legacy

legacy -> engine: Trigger Refactoring Process
activate engine

engine -> analyzer: Analyze Current Pattern
activate analyzer
note right: ApiRefactoringPattern\nSignificance: 3\nOccurrences: 5

analyzer -> analyzer: Evaluate Pattern Usage
note right: Trend: Decreasing\nCategory: Implementation

analyzer --> engine: Pattern Analysis Results
deactivate analyzer

alt Pattern Refactoring Required
    engine -> newapi: Create Improved API Structure
    activate newapi
    
    engine -> newapi: Apply Refactoring Pattern
    note right: Implementation improvements\nbased on analysis
    
    newapi --> engine: Refactored API Ready
    deactivate newapi
    
    engine --> legacy: Migration Path Available
    legacy --> client: Redirect to New API
    
    client -> newapi: Updated API Request
    activate newapi
    newapi --> client: Improved Response
    deactivate newapi
    
else Pattern Optimization Only
    engine -> legacy: Apply In-place Optimizations
    legacy --> client: Optimized Response
end

deactivate engine
deactivate legacy

note over client, analyzer: ApiRefactoringPattern shows decreasing trend\nindicating successful pattern evolution

@enduml