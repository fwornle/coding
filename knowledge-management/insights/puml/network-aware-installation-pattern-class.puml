@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

package "Knowledge Management" {
  class NetworkAwareInstallationPattern <<MCPAgent>> {
    -patternId: String
    -networkTopology: Map
    -installationState: State
    +analyzeNetwork(): NetworkInfo
    +planInstallation(): InstallationPlan
    +executeInstallation(): Result
    +validateConfiguration(): Boolean
  }
  
  class KnowledgeGraphManager {
    -graphologyInstance: Graphology
    -levelDbAdapter: LevelDB
    +storePattern(pattern: Pattern): void
    +retrievePattern(id: String): Pattern
    +updateGraph(data: GraphData): void
    +exportToJson(): JsonData
  }
  
  class SemanticAnalyzer {
    -analysisRules: Rule[]
    -patternExtractor: PatternExtractor
    +analyzeCodebase(): AnalysisResult
    +extractPatterns(): Pattern[]
    +generateKnowledge(): KnowledgeEntity
  }
}

package "Storage Layer" {
  class GraphologyStorage <<file>> {
    -graphPath: String
    +persistGraph(graph: Graph): void
    +loadGraph(): Graph
    +backup(): void
  }
  
  class LevelDBAdapter {
    -dbConnection: Connection
    -indexManager: IndexManager
    +write(key: String, value: Object): void
    +read(key: String): Object
    +query(criteria: QueryCriteria): Result[]
  }
  
  class JsonExporter {
    -exportPath: String
    -autoSyncEnabled: Boolean
    +exportGraph(): JsonFile
    +syncFromGraphDB(): void
    +scheduleAutoSync(): void
  }
}

package "MCP Server Integration" {
  interface MCPServerInterface {
    +processRequest(request: MCPRequest): MCPResponse
    +validateAgent(agent: MCPAgent): Boolean
  }
  
  class SemanticAnalysisServer {
    -patternRegistry: PatternRegistry
    -requestHandler: RequestHandler
    +handleSemanticQuery(): Response
    +registerPattern(pattern: Pattern): void
    +getPatternMetadata(): Metadata
  }
}

package "Data Locations" {
  class KnowledgeGraphStorage <<file>> {
    -location: ".data/knowledge-graph"
  }
  
  class KnowledgeExportStorage <<file>> {
    -location: ".data/knowledge-export"
  }
}

' Relationships
NetworkAwareInstallationPattern --> KnowledgeGraphManager : uses
KnowledgeGraphManager --> GraphologyStorage : persists to
KnowledgeGraphManager --> LevelDBAdapter : stores in
KnowledgeGraphManager --> JsonExporter : exports via
SemanticAnalyzer --> NetworkAwareInstallationPattern : creates
SemanticAnalysisServer ..|> MCPServerInterface : implements
SemanticAnalysisServer --> NetworkAwareInstallationPattern : manages
GraphologyStorage --> KnowledgeGraphStorage : writes to
JsonExporter --> KnowledgeExportStorage : exports to
JsonExporter ..> GraphologyStorage : syncs from

note right of NetworkAwareInstallationPattern
  Pattern extracted from codebase analysis
  Distributed across multiple modules:
  - src/knowledge-management
  - lib/ukb-unified  
  - integrations/mcp-server-semantic-analysis
end note

note bottom of KnowledgeGraphStorage
  Storage: Graphology + LevelDB
  Location: .data/knowledge-graph
end note

note bottom of KnowledgeExportStorage
  Auto-synced JSON exports
  Location: .data/knowledge-export
end note

@enduml