@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant UkbCli as "UkbCli (TransferablePattern)"
participant GraphDatabaseService as "Graph Database Service"
participant GraphKnowledgeExporter as "Graph Knowledge Exporter"
participant PersistenceAgent as "Persistence Agent"
participant VkbApiClient as "Vkb API Client"
participant MCPTools as "MCP Tools"
participant Graphology as "Graphology"
participant LevelDB as "LevelDB"

activate UkbCli
UkbCli->>GraphDatabaseService: Request knowledge graph data
GraphDatabaseService->>Graphology: Query graph database
Graphology->>LevelDB: Retrieve data from LevelDB
LevelDB->>Graphology: Return data
Graphology->>GraphDatabaseService: Return query results
GraphDatabaseService->>UkbCli: Return knowledge graph data

alt Export knowledge graph
    UkbCli->>GraphKnowledgeExporter: Request export
    GraphKnowledgeExporter->>GraphDatabaseService: Get knowledge graph data
    GraphDatabaseService->>GraphKnowledgeExporter: Return data
    GraphKnowledgeExporter->>PersistenceAgent: Export to JSON
    PersistenceAgent->>GraphKnowledgeExporter: Confirm export
    GraphKnowledgeExporter->>UkbCli: Confirm export
end

UkbCli->>VkbApiClient: Use Vkb API for external services
VkbApiClient->>UkbCli: Return API results

UkbCli->>MCPTools: Perform knowledge operations
MCPTools->>UkbCli: Return operation results

UkbCli->>GraphDatabaseService: Use vkb command for visualization
GraphDatabaseService->>UkbCli: Return visualization results

deactivate UkbCli

@enduml