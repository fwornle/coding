@startuml mcp-memory-data-flow-enhanced
!theme plain
skinparam backgroundColor white
skinparam defaultFontSize 10

title Enhanced MCP Memory Data Flow - AI-Powered Knowledge Processing

top to bottom direction

package "Enhanced Data Sources" as Sources {
    [Git Commits] as Git
    [AI Conversations] as Conversations
    [Expert Input] as Expert
    [Project Files] as ProjectFiles
    [Web Research] as WebResearch
}

package "AI-Enhanced Processing" as Processing {
    frame "Traditional UKB" {
        [UKB Analysis Engine] as UKBAnalysis
        [Significance Scoring] as Scoring
        [Pattern Recognition] as UKBPatterns
    }
    
    frame "AI Agent Network" {
        [Semantic Analysis] as SA
        [Web Search Agent] as WS
        [Knowledge Graph Agent] as KG
        [Coordinator Agent] as CA
    }
    
    [Intelligent Routing] as Routing
    [Quality Assessment] as Quality
}

package "Multi-Layer Storage" as Storage {
    frame "Persistent Storage" {
        [GraphDB + LevelDB] as SharedJSON
        [Documentation Files] as Docs
        [Git Repository] as GitRepo
    }
    
    frame "Runtime Storage" {
        [MCP Memory Server] as MCPServer
        [AI Agent State] as AgentState
        [Workflow Cache] as WorkflowCache
    }
}

package "Enhanced Claude Code Sessions" as Sessions {
    [Enhanced Startup] as Startup
    [AI-Powered MCP Tools] as AITools
    [Intelligent Queries] as SmartQueries
    [Context-Aware Responses] as SmartResponses
}

package "AI-Enhanced Benefits" as Benefits {
    [Automated Pattern Detection] as AutoPatterns
    [Intelligent Suggestions] as SmartSuggestions
    [Workflow Orchestration] as Workflows
    [Cross-Project Insights] as CrossInsights
}

package "External AI Services" as External {
    [Claude API] as ClaudeAPI
    [OpenAI API] as OpenAIAPI
    [Search Engines] as SearchEngines
    [Technical Documentation] as TechDocs
}

' Enhanced data flow
Sources --> Processing : Multi-source input
Git --> SA : Code analysis
Conversations --> SA : Conversation analysis
ProjectFiles --> SA : File analysis
Expert --> UKBAnalysis : Manual insights

' AI processing flow
SA --> Routing : AI analysis results
WS --> Routing : Research results
KG --> Routing : Entity operations
CA --> Routing : Workflow results

Routing --> Quality : Quality assessment
Quality --> Scoring : Enhanced scoring
Scoring --> UKBPatterns : Pattern validation
UKBPatterns --> SharedJSON : Validated entities

' AI agent coordination
CA --> SA : Analysis requests
CA --> WS : Research requests
CA --> KG : Entity requests
SA --> WS : Context sharing
WS --> KG : Research enrichment

' External service integration
SA --> ClaudeAPI : Primary analysis
SA --> OpenAIAPI : Fallback analysis
WS --> SearchEngines : Web search
WS --> TechDocs : Documentation search

' Enhanced storage integration
KG --> SharedJSON : Bidirectional sync
KG --> MCPServer : Runtime updates
KG --> AgentState : State persistence
CA --> WorkflowCache : Workflow templates

' Authoritative storage
SharedJSON --> GitRepo : Git tracking
Docs --> GitRepo : Version controlled
AgentState --> GitRepo : Configuration tracking

' Enhanced MCP integration
SharedJSON --> Startup : Auto-load enhanced summary
Startup --> MCPServer : Automatic memory sync ✅
MCPServer --> AgentState : State restoration
AgentState --> CA : Workflow restoration

' Enhanced session interactions
Startup --> AITools : Enhanced MCP tools available
AITools --> MCPServer : Traditional memory ops
AITools --> SA : analyze_repository
AITools --> WS : search_web
AITools --> KG : sync_with_ukb
AITools --> CA : start_workflow

SmartQueries --> MCPServer : Fast memory queries
SmartQueries --> AgentState : Agent context
SmartQueries --> WorkflowCache : Workflow status
SmartQueries --> SmartResponses : Enhanced responses

' Enhanced benefits
SmartResponses --> AutoPatterns : "AI detected 5 patterns automatically"
SmartResponses --> SmartSuggestions : "Based on analysis + research..."
SmartResponses --> Workflows : "Orchestrating comprehensive analysis"
SmartResponses --> CrossInsights : "Combining insights from 3 projects"

' Team collaboration enhanced
GitRepo --> Sessions : Enhanced team knowledge
SharedJSON --> Sessions : AI-enriched persistence
AgentState --> Sessions : Shared AI configurations

note right of Processing
  **Hybrid Processing:**
  • Traditional UKB preserved
  • AI agents provide 10x speedup
  • Quality assessment ensures accuracy
  • Intelligent routing optimizes flow
end note

note left of Storage
  **Multi-Layer Architecture:**
  • File-based authoritative storage
  • Runtime memory optimization
  • AI agent state management
  • Workflow cache for efficiency
end note

note bottom of Sessions
  **Enhanced Sessions:**
  1. Auto-loads enhanced knowledge
  2. AI tools immediately available
  3. Intelligent query processing
  4. Context-aware responses
  5. Workflow orchestration
end note

note top of Benefits
  **AI-Enhanced Benefits:**
  • "AI analyzed 50 commits, found 8 patterns"
  • "Research shows 3 better alternatives"
  • "Workflow combining analysis + research"
  • "Cross-project pattern: 95% confidence"
end note

note right of External
  **External Intelligence:**
  • LLM-powered analysis
  • Real-time web research
  • Technical documentation
  • Best practice discovery
end note

' Highlight automatic sync (fixed)
note right of Startup : ✅ AUTOMATIC SYNC\nNow working!\nKnowledge base loads\ninto MCP memory\nautomatically

@enduml