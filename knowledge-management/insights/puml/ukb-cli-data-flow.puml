@startuml ukb-cli-data-flow
!theme plain
skinparam backgroundColor white
skinparam roundcorner 20
skinparam shadowing false
title UkbCli - Data Flow and Processing Pipeline

package "Input Sources" {
  [Interactive User] as user
  [Git Repository] as git
  [Legacy UKB Script] as legacy
  [Claude Sessions] as claude
}

package "UkbCli Processing" {
  
  package "Input Layer" {
    [Command Parser] as parser
    [Interactive Prompts] as prompts
    [Git Analyzer] as git_analyzer
    [File Reader] as file_reader
  }
  
  package "Validation Pipeline" {
    [Content Filter] as filter
    [URL Validator] as url_val
    [Schema Validator] as schema_val
    [Quality Checker] as quality
  }
  
  package "Processing Engine" {
    [Entity Creator] as creator
    [Relationship Builder] as rel_builder
    [Metadata Manager] as metadata
    [Significance Calculator] as significance
  }
  
  package "Output Pipeline" {
    [JSON Serializer] as serializer
    [File Writer] as writer
    [MCP Sync] as mcp_sync
    [Visualizer Update] as viz_update
  }
}

package "Storage & Integration" {
  database "GraphDB + LevelDB" as memory
  cloud "MCP Memory Server" as mcp
  [Knowledge Visualizer] as visualizer
  [Legacy Systems] as legacy_sys
}

' Input Flow
user --> parser
user --> prompts
git --> git_analyzer
legacy --> file_reader
claude --> file_reader

' Processing Flow
parser --> filter
prompts --> filter
git_analyzer --> filter
file_reader --> filter

filter --> url_val
url_val --> schema_val
schema_val --> quality
quality --> creator

creator --> rel_builder
rel_builder --> metadata
metadata --> significance
significance --> serializer

' Output Flow
serializer --> writer
writer --> memory
serializer --> mcp_sync
mcp_sync --> mcp
serializer --> viz_update
viz_update --> visualizer

' Legacy Integration
memory --> legacy_sys

' Data Transformation Notes
note right of filter
  **Content Quality Gates:**
  - Remove marketing language
  - Ensure technical accuracy
  - Validate structure
  - Check completeness
end note

note right of creator
  **Entity Structure:**
  - Name normalization
  - Type classification
  - Observation structuring
  - Problem-solution mapping
end note

note right of significance
  **Scoring Algorithm:**
  - Cross-project applicability
  - Technical complexity
  - Innovation level
  - Implementation impact
end note

note bottom of memory
  **Enhanced Schema:**
  ```json
  {
    "entities": [...],
    "relations": [...],
    "metadata": {
      "total_entities": 20,
      "total_relations": 39,
      "last_updated": "ISO_TIMESTAMP"
    }
  }
  ```
end note

' Data Flow Labels
parser -> filter : Raw Input
filter -> creator : Validated Content
creator -> serializer : Structured Entities
serializer -> memory : Persistent Storage
mcp_sync -> mcp : Real-time Sync
viz_update -> visualizer : Live Updates

@enduml