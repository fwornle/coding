@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

package "Knowledge Management" {
    component [GraphDatabaseService] <<core>>
    component [GraphKnowledgeExporter] <<core>>
    component [GraphDatabaseAdapter] <<api>>
}

package "Storage Layer" {
    component [Graphology] <<storage>>
    component [LevelDB] <<storage>>
    folder ".data/knowledge-graph" as KGData
}

package "MCP Integration" {
    component [VkbApiClient] <<api>>
    component [PersistenceAgent] <<agent>>
    component [MCP Server] <<core>>
    component [code-graph-rag] <<core>>
}

package "Command Interface" {
    component [vkb command] <<api>>
    component [coding command] <<api>>
    component [graph-sync] <<core>>
}

package "Configuration" {
    file [.env.ports] <<config>>
    file [.data/knowledge-export] <<storage>>
}

package "Directories" {
    folder "src/knowledge-management"
    folder "lib/ukb-unified"
    folder "integrations/mcp-server-semantic-analysis/src"
}

[GraphDatabaseService] --> [Graphology]
[GraphDatabaseService] --> [LevelDB]
[GraphDatabaseService] --> KGData
[GraphKnowledgeExporter] --> [.data/knowledge-export]
[GraphDatabaseAdapter] --> [GraphDatabaseService]

[VkbApiClient] --> [GraphDatabaseAdapter]
[PersistenceAgent] --> [GraphDatabaseService]
[MCP Server] --> [code-graph-rag]

[vkb command] --> [GraphDatabaseService]
[coding command] --> [GraphDatabaseService]
[graph-sync] --> [GraphDatabaseService]

[.env.ports] --> [MCP Server]
[GraphKnowledgeExporter] --> [.data/knowledge-export]

note top of [GraphDatabaseService]
    Multi-layered architecture with 
    Graphology + LevelDB storage
end note

note bottom of [.env.ports]
    Replaces deprecated 
    shared-memory.json approach
end note

note right of [code-graph-rag]
    Git submodule with resolved
    race condition handling
end note

@enduml