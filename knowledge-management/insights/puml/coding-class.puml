@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

package "Knowledge Management" {
    class KnowledgeManager <<service>> {
        -graphDatabase: GraphologyAdapter
        -levelDbAdapter: LevelDBAdapter
        +storeKnowledge(data: any): Promise<void>
        +queryKnowledge(query: string): Promise<any>
        +exportToJson(): Promise<void>
    }
    
    class GraphologyAdapter <<adapter>> {
        -graph: Graph
        +addNode(id: string, data: any): void
        +addEdge(source: string, target: string): void
        +findPaths(from: string, to: string): Path[]
    }
    
    class LevelDBAdapter <<adapter>> {
        -db: LevelDB
        +put(key: string, value: any): Promise<void>
        +get(key: string): Promise<any>
        +batch(operations: Operation[]): Promise<void>
    }
}

package "Semantic Analysis" {
    class SemanticAnalyzer <<service>> {
        -knowledgeManager: KnowledgeManager
        +analyzeCode(source: string): Promise<Analysis>
        +extractSemantics(ast: AST): SemanticData
        +buildKnowledgeGraph(semantics: SemanticData): void
    }
    
    class McpServerAdapter <<adapter>> {
        -semanticAnalyzer: SemanticAnalyzer
        +handleRequest(request: McpRequest): Promise<McpResponse>
        +processSemanticQuery(query: string): Promise<any>
    }
}

package "Unified Library" {
    class UkbUnifiedCore <<core>> {
        -knowledgeManager: KnowledgeManager
        -semanticAnalyzer: SemanticAnalyzer
        +initialize(): Promise<void>
        +processProject(path: string): Promise<void>
        +exportKnowledge(): Promise<void>
    }
    
    interface KnowledgeStorage <<interface>> {
        +store(key: string, value: any): Promise<void>
        +retrieve(key: string): Promise<any>
        +query(pattern: string): Promise<any[]>
    }
}

package "Data Storage" {
    class KnowledgeGraphStore <<file>> {
        +location: ".data/knowledge-graph"
        +type: "LevelDB + Graphology"
    }
    
    class JsonExportStore <<file>> {
        +location: ".data/knowledge-export"
        +autoSync: boolean
        +format: "JSON"
    }
}

package "Coding Project" {
    class CodingProject <<entity>> {
        -srcPath: "src/knowledge-management"
        -libPath: "lib/ukb-unified"
        -mcpPath: "integrations/mcp-server-semantic-analysis/src"
        +analyze(): Promise<ProjectAnalysis>
        +buildKnowledgeBase(): Promise<void>
    }
}

' Relationships
UkbUnifiedCore --> KnowledgeManager : uses
UkbUnifiedCore --> SemanticAnalyzer : uses
SemanticAnalyzer --> KnowledgeManager : stores results
McpServerAdapter --> SemanticAnalyzer : delegates to
KnowledgeManager --> GraphologyAdapter : delegates to
KnowledgeManager --> LevelDBAdapter : delegates to
KnowledgeManager --> KnowledgeGraphStore : persists to
KnowledgeManager --> JsonExportStore : exports to
GraphologyAdapter ..|> KnowledgeStorage : implements
LevelDBAdapter ..|> KnowledgeStorage : implements
CodingProject --> UkbUnifiedCore : orchestrates

' Notes
note right of KnowledgeGraphStore : "Replaced shared-memory.json\nwith persistent storage"
note bottom of JsonExportStore : "Auto-synced from GraphDB"

@enduml