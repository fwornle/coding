@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "MCP Client" as Client
participant "Semantic Analysis\nMCP Server" as MCPServer
participant "Knowledge Management\nCore" as KnowledgeCore
participant "UKB Unified\nLibrary" as UKBLib
participant "Semantic Processor" as Processor
participant "Analysis Engine" as Engine

Client -> MCPServer: Initialize semantic analysis request
activate MCPServer

MCPServer -> KnowledgeCore: Load knowledge base
activate KnowledgeCore
KnowledgeCore -> UKBLib: Access unified knowledge structures
activate UKBLib
UKBLib --> KnowledgeCore: Return knowledge graph
deactivate UKBLib
KnowledgeCore --> MCPServer: Knowledge base ready
deactivate KnowledgeCore

MCPServer -> Processor: Start semantic processing
activate Processor

Processor -> Engine: Analyze semantic patterns
activate Engine

alt Complex Analysis Required
    Engine -> UKBLib: Query semantic relationships
    activate UKBLib
    UKBLib --> Engine: Return semantic mappings
    deactivate UKBLib
    
    Engine -> KnowledgeCore: Update knowledge graph
    activate KnowledgeCore
    KnowledgeCore --> Engine: Confirm updates
    deactivate KnowledgeCore
else Simple Analysis
    Engine -> Engine: Process locally
end

Engine --> Processor: Return analysis results
deactivate Engine

Processor -> MCPServer: Compile comprehensive results
deactivate Processor

MCPServer --> Client: Return semantic analysis
deactivate MCPServer

note right of UKBLib
  Unified knowledge base
  replacing shared-memory.json
end note

note left of KnowledgeCore
  Located in:
  src/knowledge-management
end note

note over MCPServer
  Located in:
  integrations/mcp-server-semantic-analysis/src
end note

@enduml