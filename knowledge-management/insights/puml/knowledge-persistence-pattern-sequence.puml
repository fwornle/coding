@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant KnowledgePersistencePattern as "Knowledge Persistence Pattern"
participant GraphDatabaseService as "Graph Database Service"
participant GraphKnowledgeExporter as "Graph Knowledge Exporter"
participant PersistenceAgent as "Persistence Agent"
participant EnvironmentVariables as "Environment Variables"

activate KnowledgePersistencePattern
KnowledgePersistencePattern ->> GraphDatabaseService: Initialize Graph Database
GraphDatabaseService ->> KnowledgePersistencePattern: Confirm Initialization

alt Successful Initialization
    KnowledgePersistencePattern ->> PersistenceAgent: Persist Knowledge Data
    PersistenceAgent ->> GraphDatabaseService: Store Knowledge Data
    GraphDatabaseService ->> PersistenceAgent: Confirm Storage
    activate GraphKnowledgeExporter
    GraphKnowledgeExporter ->> GraphDatabaseService: Request JSON Data
    GraphDatabaseService ->> GraphKnowledgeExporter: Provide JSON Data
    GraphKnowledgeExporter ->> GraphKnowledgeExporter: Auto-Export JSON Data
    GraphKnowledgeExporter ->> EnvironmentVariables: Configure Export Directory (.data/knowledge-export)
    EnvironmentVariables ->> GraphKnowledgeExporter: Confirm Configuration
    GraphKnowledgeExporter ->> GraphKnowledgeExporter: Export JSON Data to Directory
    deactivate GraphKnowledgeExporter
end

opt Auto-Syncing JSON Data
    KnowledgePersistencePattern ->> GraphKnowledgeExporter: Trigger Auto-Export (entity:stored)
    GraphKnowledgeExporter ->> GraphDatabaseService: Request Updated JSON Data
    GraphDatabaseService ->> GraphKnowledgeExporter: Provide Updated JSON Data
    GraphKnowledgeExporter ->> GraphKnowledgeExporter: Auto-Export Updated JSON Data
    GraphKnowledgeExporter ->> EnvironmentVariables: Update Export Directory (.data/knowledge-export)
    EnvironmentVariables ->> GraphKnowledgeExporter: Confirm Update
end

KnowledgePersistencePattern ->> GraphDatabaseService: Retrieve Knowledge Data
GraphDatabaseService ->> KnowledgePersistencePattern: Provide Knowledge Data

deactivate KnowledgePersistencePattern

@enduml