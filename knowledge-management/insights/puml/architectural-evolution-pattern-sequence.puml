@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "User" as U
participant "VKB CLI" as CLI
participant "GraphDatabaseService" as GDS
participant "Graphology + LevelDB" as DB
participant "GraphKnowledgeExporter" as GKE
participant "VkbApiClient" as API
participant "External Services" as EXT

U -> CLI: Execute vkb command
activate CLI

CLI -> GDS: Request graph operations
activate GDS

GDS -> DB: Query/Store data
note right: Located at .data/knowledge-graph
activate DB
DB --> GDS: Return graph data
deactivate DB

GDS --> CLI: Return processed data
deactivate GDS

alt Visualization Command
    CLI -> GDS: Request visualization data
    activate GDS
    GDS -> DB: Retrieve graph structure
    activate DB
    DB --> GDS: Graph topology
    deactivate DB
    GDS --> CLI: Formatted visualization
    deactivate GDS
    CLI --> U: Display graph visualization
end

alt Development Task (coding)
    CLI -> GDS: Process development request
    activate GDS
    GDS -> DB: Update knowledge graph
    activate DB
    DB --> GDS: Confirmation
    deactivate DB
    GDS --> CLI: Development result
    deactivate GDS
end

alt Graph Synchronization
    U -> CLI: Execute graph-sync
    CLI -> GKE: Trigger export process
    activate GKE
    
    GKE -> GDS: Request current graph state
    activate GDS
    GDS -> DB: Fetch complete graph
    activate DB
    DB --> GDS: Full graph data
    deactivate DB
    GDS --> GKE: Structured data
    deactivate GDS
    
    GKE -> GKE: Generate JSON export
    note right: Auto-sync to .data/knowledge-export
    
    GKE -> API: Sync with external services
    activate API
    API -> EXT: Send synchronized data
    activate EXT
    EXT --> API: Confirmation
    deactivate EXT
    API --> GKE: Sync status
    deactivate API
    
    GKE --> CLI: Export completed
    deactivate GKE
end

CLI --> U: Command completed
deactivate CLI

note over U, EXT: Component-based architecture with\nseparate knowledge management,\nunified utilities, and analysis services

@enduml