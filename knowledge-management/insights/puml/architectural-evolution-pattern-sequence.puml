@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "VkbApiClient" as VKB
participant "Command Interface" as CMD
participant "Knowledge Management" as KM
participant "Semantic Analysis Service" as SAS
participant "Parallel Worker" as PW
participant "GraphDatabaseService" as GDS
participant "GraphKnowledgeExporter" as GKE
participant "GraphDatabaseAdapter" as GDA
participant "PersistenceAgent" as PA
participant "Storage (Graphology + LevelDB)" as STORE

== Knowledge Management Operations ==
VKB -> CMD: External integration request
CMD -> KM: Process knowledge operation
KM -> SAS: Semantic analysis request
SAS -> PW: Batch mode analysis

opt Parallel Processing
    PW -> PW: Process batch items
    PW -> GDS: Update graph data
end

GDS -> STORE: Store in Graphology + LevelDB
GDS -> GKE: Trigger export
GKE -> GKE: Auto-sync JSON export
GKE -> STORE: Save to .data/knowledge-export

== Command Interface Operations ==
CMD -> CMD: vkb (visualization)
CMD -> CMD: coding (development tasks)
CMD -> CMD: graph-sync (data synchronization)

alt Write/Edit Operations
    CMD -> KM: Content update request
    KM -> SAS: Incremental constraint validation
    SAS -> SAS: Update classification
    SAS -> GDS: Apply changes
    GDS -> PA: Persist changes
    PA -> GDA: Database operations
    GDA -> STORE: Update storage
else Read Operations
    CMD -> GDS: Query request
    GDS -> STORE: Retrieve data
    STORE -> GDS: Return results
    GDS -> CMD: Response
end

== Synchronization Process ==
GDS -> GKE: Periodic sync trigger
GKE -> STORE: Export knowledge graph
note right: JSON exports at .data/knowledge-export
GKE -> GDA: Update adapter layer
GDA -> PA: Persistence operations

@enduml