@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "MCP Client" as client
participant "MCP Server" as server
participant "CodingWorkflow" as workflow
participant "Knowledge Manager" as km
participant "Graphology DB" as graph
participant "LevelDB" as level
participant "JSON Export" as export

client -> server: execute_workflow(CodingWorkflow)
activate server

server -> workflow: trigger()
activate workflow

workflow -> km: initializeKnowledgeStorage()
activate km

km -> graph: connect(.data/knowledge-graph)
activate graph
graph --> km: connection established

km -> level: initialize(.data/knowledge-graph)
activate level
level --> km: storage ready

km --> workflow: storage initialized

workflow -> workflow: performSemanticAnalysis()

alt incremental analysis
    workflow -> km: getExistingKnowledge()
    km -> graph: query(existing_entities)
    graph --> km: current_state
    km --> workflow: knowledge_delta
else full analysis
    workflow -> workflow: analyzeFullCodebase()
end

workflow -> km: storeAnalysisResults(results)
km -> graph: updateNodes(entities)
km -> graph: updateEdges(relationships)
graph --> km: stored

workflow -> km: exportKnowledge()
km -> export: syncToJSON(.data/knowledge-export)
activate export
export --> km: export_complete

workflow -> server: analysisComplete(results)
deactivate workflow

server -> client: workflow_executed(success)
deactivate server

note over graph, level: Knowledge persisted in\nGraphology + LevelDB
note over export: Auto-synced JSON exports\nfor external consumption

@enduml