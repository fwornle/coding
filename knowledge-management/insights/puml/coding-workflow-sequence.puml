@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

participant "MCP Client" as MCP
participant "MCP Server\nSemantic Analysis" as MCPSA
participant "CodingWorkflow\nEngine" as CW
participant "Knowledge\nManagement" as KM
participant "Graphology\nGraph DB" as GDB
participant "LevelDB\nStorage" as LDB
participant "JSON Export\nSync" as JES

note over MCP, JES: CodingWorkflow Sequence - Graph Database Architecture

MCP -> MCPSA: execute_workflow(parameters)
activate MCPSA

MCPSA -> CW: initiate_coding_workflow()
activate CW

CW -> KM: load_knowledge_context()
activate KM

KM -> GDB: query_graph_nodes()
activate GDB

GDB -> LDB: read_persistent_data()
activate LDB
LDB --> GDB: graph_data
deactivate LDB

GDB --> KM: knowledge_nodes
deactivate GDB

KM --> CW: context_loaded
deactivate KM

CW -> CW: process_incremental_analysis()

alt Automatic Incremental Analysis
    CW -> KM: detect_code_changes()
    KM -> GDB: update_graph_structure()
    activate GDB
    GDB -> LDB: persist_changes()
    activate LDB
    LDB --> GDB: changes_saved
    deactivate LDB
    deactivate GDB
end

CW -> KM: update_knowledge_graph()
activate KM

KM -> GDB: add_semantic_relationships()
activate GDB

GDB -> LDB: store_graph_updates()
activate LDB
LDB --> GDB: update_confirmed
deactivate LDB

GDB --> KM: graph_updated
deactivate GDB

KM -> JES: trigger_auto_sync()
activate JES

JES -> GDB: export_graph_data()
activate GDB
GDB --> JES: json_data
deactivate GDB

JES -> JES: write_to_export_directory\n(.data/knowledge-export)
JES --> KM: sync_completed
deactivate JES

KM --> CW: knowledge_updated
deactivate KM

CW --> MCPSA: workflow_results
deactivate CW

MCPSA --> MCP: analysis_complete
deactivate MCPSA

note over GDB, LDB: Storage Location: .data/knowledge-graph
note over JES: Export Location: .data/knowledge-export
note over MCPSA: Removed: shared-memory.json (legacy)

@enduml