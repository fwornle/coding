@startuml
!include /Users/q284340/Agentic/coding/docs/puml/_standard-style.puml

package "MCP Agent Framework" {
    abstract class MCPAgent <<agent>> {
        +name: string
        +version: string
        +capabilities: string[]
        +initialize(): void
        +process(request: Request): Response
    }
}

package "Semantic Analysis Core" {
    class ComprehensiveSemanticAnalysis <<service>> {
        -analysisEngine: AnalysisEngine
        -knowledgeGraph: GraphologyAdapter
        -contextProcessor: ContextProcessor
        +analyzeText(input: string): AnalysisResult
        +extractEntities(): Entity[]
        +performDeepAnalysis(): SemanticResult
        +updateKnowledge(): void
    }
    
    class AnalysisEngine <<engine>> {
        -nlpProcessor: NLPProcessor
        -semanticRules: Rule[]
        +processInput(text: string): ParsedResult
        +applySemanticRules(): RuleResult
        +generateInsights(): Insight[]
    }
    
    class ContextProcessor <<processor>> {
        -contextMemory: Map
        -relationshipExtractor: RelationshipExtractor
        +buildContext(input: string): Context
        +maintainContext(): void
        +extractRelationships(): Relationship[]
    }
}

package "Knowledge Management" <<folder>> {
    class GraphologyAdapter <<adapter>> {
        -graph: GraphologyInstance
        -levelDbStore: LevelDBStore
        +addNode(node: Node): void
        +addEdge(edge: Edge): void
        +queryGraph(query: GraphQuery): Result[]
        +persistGraph(): void
    }
    
    class LevelDBStore <<storage>> {
        -dbPath: string
        -connection: LevelDBConnection
        +store(key: string, value: any): void
        +retrieve(key: string): any
        +delete(key: string): void
        +createIndex(): void
    }
    
    class KnowledgeGraph <<domain>> {
        -nodes: Node[]
        -edges: Edge[]
        -metadata: GraphMetadata
        +buildGraph(): void
        +updateGraph(): void
        +searchGraph(criteria: SearchCriteria): Result[]
    }
}

package "Integration Layer" {
    class MCPServerSemanticAnalysis <<server>> {
        -analysisService: ComprehensiveSemanticAnalysis
        -requestHandler: RequestHandler
        -responseFormatter: ResponseFormatter
        +handleRequest(mcpRequest: MCPRequest): MCPResponse
        +formatResponse(result: AnalysisResult): MCPResponse
    }
    
    class RequestHandler <<handler>> {
        -validator: RequestValidator
        -parser: RequestParser
        +validateRequest(request: MCPRequest): boolean
        +parseRequest(request: MCPRequest): ParsedRequest
    }
    
    class ResponseFormatter <<formatter>> {
        +formatAnalysisResult(result: AnalysisResult): FormattedResponse
        +formatError(error: Error): ErrorResponse
    }
}

package "Data Storage" {
    class DataPath <<file>> {
        +path: ".data/knowledge-graph"
        +structure: "LevelDB + Graphology"
    }
}

' Inheritance relationships
MCPAgent <|-- ComprehensiveSemanticAnalysis

' Composition relationships
ComprehensiveSemanticAnalysis *-- AnalysisEngine
ComprehensiveSemanticAnalysis *-- ContextProcessor
ComprehensiveSemanticAnalysis *-- GraphologyAdapter

GraphologyAdapter *-- LevelDBStore
GraphologyAdapter *-- KnowledgeGraph

MCPServerSemanticAnalysis *-- ComprehensiveSemanticAnalysis
MCPServerSemanticAnalysis *-- RequestHandler
MCPServerSemanticAnalysis *-- ResponseFormatter

' Dependencies
LevelDBStore ..> DataPath : stores data in
GraphologyAdapter ..> KnowledgeGraph : manages
AnalysisEngine ..> ContextProcessor : collaborates with

' Notes
note right of ComprehensiveSemanticAnalysis
  Main semantic analysis agent
  Distributed across multiple modules:
  - src/knowledge-management
  - lib/ukb-unified  
  - integrations/mcp-server-semantic-analysis
end note

note bottom of DataPath
  Replaced shared-memory.json
  Uses Graphology + LevelDB
  Located at .data/knowledge-graph
end note

@enduml