{
  "name": "Coding Infrastructure Ontology",
  "version": "1.0.0",
  "type": "lower",
  "team": "coding",
  "extendsOntology": "development-knowledge",
  "description": "Lower ontology for the coding infrastructure project, covering knowledge management, live session logging, constraint monitoring, trajectory generation, and MCP integrations",
  "entities": {
    "LSLSession": {
      "description": "A live session logging session with time-windowed conversation capture",
      "extendsEntity": "AnalysisArtifact",
      "properties": {
        "sessionFile": {
          "type": "string",
          "description": "LSL markdown file path (format: YYYY-MM-DD_HHMM-HHMM_<user-hash>.md)",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}_\\d{4}-\\d{4}_[a-z0-9]{6}(_from-[a-z-]+)?\\.md$"
        },
        "timeWindow": {
          "type": "object",
          "description": "Time boundaries for the session",
          "properties": {
            "start": {
              "type": "string",
              "description": "Session start time (ISO 8601)"
            },
            "end": {
              "type": "string",
              "description": "Session end time (ISO 8601)"
            }
          }
        },
        "userHash": {
          "type": "string",
          "description": "6-character user hash for collision prevention",
          "pattern": "^[a-z0-9]{6}$"
        },
        "sourceProject": {
          "type": "string",
          "description": "Originating project path"
        },
        "redirectedFrom": {
          "type": "string",
          "description": "Source project name if this is coding-redirected content"
        },
        "transcriptPath": {
          "type": "string",
          "description": "Claude transcript JSONL file path"
        },
        "exchangeCount": {
          "type": "number",
          "description": "Number of conversation exchanges in session"
        }
      },
      "requiredProperties": ["sessionFile", "timeWindow", "userHash", "sourceProject"],
      "examples": [
        "2025-10-05_1400-1500_g9b30a.md",
        "2025-10-05_1400-1500_g9b30a_from-curriculum-alignment.md"
      ]
    },
    "ClassificationLayer": {
      "description": "A classification layer in the 5-layer LSL classification system",
      "extendsEntity": "ModelComponent",
      "properties": {
        "layerId": {
          "type": "string",
          "description": "Layer identifier",
          "enum": ["session_filter", "path", "keyword", "embedding", "semantic"]
        },
        "layerNumber": {
          "type": "number",
          "description": "Layer position (0-4)"
        },
        "processingTime": {
          "type": "number",
          "description": "Average processing time in milliseconds"
        },
        "accuracyRate": {
          "type": "number",
          "description": "Classification accuracy (0-1)"
        },
        "earlyExitEnabled": {
          "type": "boolean",
          "description": "Whether layer can terminate classification early"
        },
        "implementation": {
          "type": "string",
          "description": "Implementation class name"
        }
      },
      "requiredProperties": ["layerId", "layerNumber", "processingTime"],
      "examples": [
        "PathAnalyzer (Layer 1, <1ms, artifact checking)",
        "EmbeddingClassifier (Layer 3, <3ms, vector similarity)"
      ]
    },
    "ConstraintRule": {
      "description": "A coding constraint enforced via PreToolUse hooks",
      "extendsEntity": "QualityMetric",
      "properties": {
        "constraintId": {
          "type": "string",
          "description": "Unique constraint identifier"
        },
        "severity": {
          "type": "string",
          "description": "Enforcement severity level",
          "enum": ["critical", "error", "warning", "info"]
        },
        "pattern": {
          "type": "string",
          "description": "Regex pattern for detection"
        },
        "category": {
          "type": "string",
          "description": "Constraint category",
          "enum": ["security", "architecture", "code_quality", "plantuml", "documentation"]
        },
        "blocking": {
          "type": "boolean",
          "description": "Whether violation blocks tool execution"
        },
        "complianceImpact": {
          "type": "number",
          "description": "Impact on compliance score (-3.0 to 0)"
        },
        "detectionRate": {
          "type": "number",
          "description": "Test detection rate (0-1)"
        }
      },
      "requiredProperties": ["constraintId", "severity", "pattern", "category"],
      "examples": [
        "no-hardcoded-secrets (critical, security, -3.0 impact)",
        "no-parallel-files (critical, architecture, prevents v2/enhanced suffixes)"
      ]
    },
    "TrajectoryState": {
      "description": "Real-time development trajectory state during Claude Code session",
      "extendsEntity": "AnalysisArtifact",
      "properties": {
        "state": {
          "type": "string",
          "description": "Current trajectory state",
          "enum": ["exploring", "on_track", "off_track", "implementing", "verifying", "blocked"]
        },
        "icon": {
          "type": "string",
          "description": "Status line icon representation"
        },
        "confidence": {
          "type": "number",
          "description": "AI classification confidence (0-1)"
        },
        "timestamp": {
          "type": "string",
          "description": "State update timestamp"
        },
        "reasoning": {
          "type": "string",
          "description": "AI reasoning for state classification"
        },
        "statePersistence": {
          "type": "string",
          "description": "JSON file path for state persistence (.specstory/trajectory/live-state.json)"
        }
      },
      "requiredProperties": ["state", "icon", "confidence", "timestamp"],
      "examples": [
        "ðŸ” EX (exploring, gathering information)",
        "âš™ï¸ IMP (implementing, active code modification)"
      ]
    },
    "MCPAgent": {
      "description": "A specialized agent in the MCP Semantic Analysis Server",
      "extendsEntity": "ModelComponent",
      "properties": {
        "agentName": {
          "type": "string",
          "description": "Agent identifier"
        },
        "agentType": {
          "type": "string",
          "description": "Agent category",
          "enum": ["orchestration", "analysis_no_llm", "llm_powered", "infrastructure"]
        },
        "usesLLM": {
          "type": "boolean",
          "description": "Whether agent requires LLM"
        },
        "coordinatedBy": {
          "type": "reference",
          "description": "Reference to CoordinatorAgent",
          "targetEntityClass": "MCPAgent"
        },
        "capabilities": {
          "type": "array",
          "description": "Agent capabilities",
          "items": {
            "type": "string",
            "description": "Capability name"
          }
        },
        "dependencies": {
          "type": "array",
          "description": "Required services or data",
          "items": {
            "type": "string",
            "description": "Dependency name"
          }
        }
      },
      "requiredProperties": ["agentName", "agentType", "usesLLM"],
      "examples": [
        "CoordinatorAgent (orchestration, workflow coordination)",
        "SemanticAnalysisAgent (llm_powered, 3-tier LLM chain)"
      ]
    },
    "KnowledgeEntity": {
      "description": "A knowledge graph entity with observations in GraphDatabaseService",
      "extendsEntity": "SystemComponent",
      "properties": {
        "entityId": {
          "type": "string",
          "description": "Unique entity identifier (UUID)"
        },
        "entityType": {
          "type": "string",
          "description": "Entity type classification"
        },
        "observations": {
          "type": "array",
          "description": "Array of observation strings",
          "items": {
            "type": "string",
            "description": "Observation content"
          }
        },
        "relations": {
          "type": "array",
          "description": "Relationships to other entities",
          "items": {
            "type": "object",
            "description": "Entity relationship"
          }
        },
        "metadata": {
          "type": "object",
          "description": "Additional entity metadata"
        },
        "source": {
          "type": "string",
          "description": "Source of knowledge extraction"
        },
        "timestamp": {
          "type": "string",
          "description": "Entity creation/update timestamp"
        }
      },
      "requiredProperties": ["entityId", "entityType", "observations"],
      "examples": [
        "Entity: StreamingKnowledgeExtractor (entityType: system_component)",
        "Entity: LSL 5-layer Classification (entityType: analysis_system)"
      ]
    },
    "EmbeddingVector": {
      "description": "Vector embedding for semantic similarity search",
      "extendsEntity": "DataRepresentation",
      "properties": {
        "dimensions": {
          "type": "number",
          "description": "Vector dimensionality",
          "enum": ["384", "1536"]
        },
        "model": {
          "type": "string",
          "description": "Embedding model used"
        },
        "provider": {
          "type": "string",
          "description": "Embedding provider",
          "enum": ["local_transformers", "openai"]
        },
        "contentHash": {
          "type": "string",
          "description": "Hash of source content"
        },
        "similarityMetric": {
          "type": "string",
          "description": "Similarity calculation method",
          "enum": ["cosine", "euclidean", "dot_product"]
        }
      },
      "requiredProperties": ["dimensions", "model", "provider"],
      "examples": [
        "384-dim local (Xenova/all-MiniLM-L6-v2, Transformers.js)",
        "1536-dim remote (text-embedding-3-small, OpenAI)"
      ]
    },
    "HookConfiguration": {
      "description": "Claude Code hook configuration for PreToolUse or PostToolUse",
      "extendsEntity": "ConfigurationData",
      "properties": {
        "hookType": {
          "type": "string",
          "description": "Hook execution timing",
          "enum": ["PreToolUse", "PostToolUse", "PrePrompt"]
        },
        "matcher": {
          "type": "string",
          "description": "Tool name pattern to match"
        },
        "command": {
          "type": "string",
          "description": "Command to execute"
        },
        "wrapperScript": {
          "type": "string",
          "description": "Wrapper script path"
        },
        "purpose": {
          "type": "string",
          "description": "Hook purpose",
          "enum": ["constraint_enforcement", "lsl_logging", "monitoring"]
        }
      },
      "requiredProperties": ["hookType", "matcher", "command"],
      "examples": [
        "PreToolUse: constraint enforcement (pre-tool-hook-wrapper.js)",
        "PostToolUse: LSL logging (tool-interaction-hook-wrapper.js)"
      ]
    },
    "MonitoringLayer": {
      "description": "A layer in the 4-layer LSL monitoring architecture",
      "extendsEntity": "SystemComponent",
      "properties": {
        "layerName": {
          "type": "string",
          "description": "Layer identifier",
          "enum": ["system_watchdog", "global_coordinator", "monitoring_verifier", "service_health"]
        },
        "layerLevel": {
          "type": "number",
          "description": "Layer position (1-4)"
        },
        "executionMode": {
          "type": "string",
          "description": "How layer runs",
          "enum": ["launchd_service", "daemon", "session_startup", "self_monitoring"]
        },
        "healthCheckInterval": {
          "type": "number",
          "description": "Health check interval in milliseconds"
        },
        "recoveryCapability": {
          "type": "boolean",
          "description": "Whether layer can restart failed services"
        }
      },
      "requiredProperties": ["layerName", "layerLevel", "executionMode"],
      "examples": [
        "System Watchdog (Layer 1, macOS launchd, ultimate failsafe)",
        "Global Service Coordinator (Layer 2, daemon, self-healing)"
      ]
    },
    "HealthFile": {
      "description": "Health monitoring file for service status tracking",
      "extendsEntity": "ConfigurationData",
      "properties": {
        "filePath": {
          "type": "string",
          "description": "Health file path (.transcript-monitor-health)"
        },
        "processId": {
          "type": "number",
          "description": "Process ID of monitored service"
        },
        "status": {
          "type": "string",
          "description": "Service status",
          "enum": ["running", "stopped", "suspicious", "stale"]
        },
        "metrics": {
          "type": "object",
          "description": "Process metrics (memory, CPU, uptime)"
        },
        "lastUpdate": {
          "type": "string",
          "description": "Last update timestamp"
        },
        "isSuspicious": {
          "type": "boolean",
          "description": "Suspicious activity detected"
        }
      },
      "requiredProperties": ["filePath", "processId", "status", "lastUpdate"],
      "examples": [
        ".transcript-monitor-health (enhanced-transcript-monitor)",
        "health check file for constraint monitor"
      ]
    },
    "ConfigurationFile": {
      "description": "JSON or YAML configuration file for system components",
      "extendsEntity": "ConfigurationData",
      "properties": {
        "configPath": {
          "type": "string",
          "description": "Configuration file path"
        },
        "format": {
          "type": "string",
          "description": "File format",
          "enum": ["json", "yaml"]
        },
        "component": {
          "type": "string",
          "description": "Component configured by this file"
        },
        "schema": {
          "type": "string",
          "description": "JSON Schema validation file path"
        },
        "reloadable": {
          "type": "boolean",
          "description": "Whether config can be reloaded without restart"
        }
      },
      "requiredProperties": ["configPath", "format", "component"],
      "examples": [
        "config/live-logging-config.json (LSL system)",
        "constraints.yaml (constraint monitor, 18 rules)"
      ]
    },
    "RedactionPattern": {
      "description": "Security redaction pattern for sanitizing sensitive information",
      "extendsEntity": "QualityMetric",
      "properties": {
        "patternId": {
          "type": "string",
          "description": "Pattern identifier"
        },
        "patternName": {
          "type": "string",
          "description": "Human-readable pattern name"
        },
        "regex": {
          "type": "string",
          "description": "Regex pattern for detection"
        },
        "severity": {
          "type": "string",
          "description": "Security severity",
          "enum": ["low", "medium", "high", "critical"]
        },
        "enabled": {
          "type": "boolean",
          "description": "Whether pattern is active"
        },
        "redactionTarget": {
          "type": "string",
          "description": "What to redact",
          "enum": ["api_keys", "passwords", "tokens", "connection_strings", "emails", "user_ids"]
        }
      },
      "requiredProperties": ["patternId", "patternName", "regex", "severity"],
      "examples": [
        "API keys (sk-, xai- prefixes, critical severity)",
        "Connection strings (MongoDB, PostgreSQL, MySQL, high severity)"
      ]
    },
    "ToolWrapper": {
      "description": "Bash command wrapper for tool execution",
      "extendsEntity": "ExecutionContext",
      "properties": {
        "wrapperPath": {
          "type": "string",
          "description": "Wrapper script path"
        },
        "targetCommand": {
          "type": "string",
          "description": "Command being wrapped"
        },
        "purpose": {
          "type": "string",
          "description": "Wrapper purpose",
          "enum": ["security_check", "logging", "monitoring", "validation"]
        },
        "timeoutMs": {
          "type": "number",
          "description": "Execution timeout in milliseconds"
        },
        "exitCodeMapping": {
          "type": "object",
          "description": "Exit code interpretation"
        }
      },
      "requiredProperties": ["wrapperPath", "targetCommand", "purpose"],
      "examples": [
        "pre-tool-hook-wrapper.js (constraint checks, blocks on error)",
        "tool-interaction-hook-wrapper.js (LSL logging, non-blocking)"
      ]
    },
    "GraphDatabase": {
      "description": "Graphology + LevelDB persistent graph database",
      "extendsEntity": "SystemComponent",
      "properties": {
        "storagePath": {
          "type": "string",
          "description": "LevelDB storage directory (.data/knowledge-graph/)"
        },
        "graphEngine": {
          "type": "string",
          "description": "In-memory graph engine (Graphology)"
        },
        "persistenceEngine": {
          "type": "string",
          "description": "Persistent storage engine (LevelDB)"
        },
        "nodeCount": {
          "type": "number",
          "description": "Number of nodes in graph"
        },
        "edgeCount": {
          "type": "number",
          "description": "Number of edges in graph"
        },
        "autoExportInterval": {
          "type": "number",
          "description": "Auto-export interval in milliseconds (30s)"
        }
      },
      "requiredProperties": ["storagePath", "graphEngine", "persistenceEngine"],
      "examples": [
        "GraphDatabaseService (.data/knowledge-graph/, Graphology + LevelDB)"
      ]
    },
    "VectorDatabase": {
      "description": "Qdrant vector database collection for semantic search",
      "extendsEntity": "SystemComponent",
      "properties": {
        "collectionName": {
          "type": "string",
          "description": "Qdrant collection identifier"
        },
        "vectorDimension": {
          "type": "number",
          "description": "Vector dimensionality"
        },
        "distance": {
          "type": "string",
          "description": "Distance metric",
          "enum": ["Cosine", "Euclidean", "Dot"]
        },
        "indexingAlgorithm": {
          "type": "string",
          "description": "Indexing algorithm (HNSW)"
        },
        "pointCount": {
          "type": "number",
          "description": "Number of indexed vectors"
        }
      },
      "requiredProperties": ["collectionName", "vectorDimension", "distance"],
      "examples": [
        "coding_repository (384-dim, Cosine, 183 files indexed)",
        "knowledge_embeddings (1536-dim, Cosine, semantic search)"
      ]
    },
    "WorkflowDefinition": {
      "description": "Multi-agent workflow coordination definition",
      "extendsEntity": "ExecutionContext",
      "properties": {
        "workflowName": {
          "type": "string",
          "description": "Workflow identifier"
        },
        "steps": {
          "type": "array",
          "description": "Workflow steps with dependencies",
          "items": {
            "type": "object",
            "description": "Workflow step"
          }
        },
        "dataFlow": {
          "type": "object",
          "description": "Step result templating ({{step_name.result}})"
        },
        "agentOrchestration": {
          "type": "string",
          "description": "Coordinator that orchestrates agents"
        }
      },
      "requiredProperties": ["workflowName", "steps", "agentOrchestration"],
      "examples": [
        "complete-analysis (GitHistory â†’ VibeHistory â†’ Semantic â†’ WebSearch â†’ Insights)"
      ]
    },
    "PlantUMLDiagram": {
      "description": "PlantUML architecture diagram with standardized styling",
      "extendsEntity": "DocumentationAsset",
      "properties": {
        "pumlPath": {
          "type": "string",
          "description": "PlantUML source file path (docs/presentation/puml/)"
        },
        "pngPath": {
          "type": "string",
          "description": "Generated PNG image path (docs/presentation/images/)"
        },
        "diagramType": {
          "type": "string",
          "description": "Diagram type",
          "enum": ["component", "sequence", "activity", "class", "deployment"]
        },
        "standardStyleIncluded": {
          "type": "boolean",
          "description": "Whether !include _standard-style.puml is present"
        },
        "presentationMode": {
          "type": "boolean",
          "description": "Whether diagram is optimized for presentation (thicker lines, larger fonts)"
        }
      },
      "requiredProperties": ["pumlPath", "pngPath", "diagramType"],
      "examples": [
        "ontology-system-architecture.puml (component diagram)",
        "lsl-classification-flow.puml (sequence diagram)"
      ]
    },
    "ServiceRegistry": {
      "description": "Global service coordinator registry tracking",
      "extendsEntity": "ConfigurationData",
      "properties": {
        "registryPath": {
          "type": "string",
          "description": "Registry file path (.global-service-registry.json)"
        },
        "coordinatorPid": {
          "type": "number",
          "description": "Global coordinator process ID"
        },
        "registeredProjects": {
          "type": "array",
          "description": "List of registered project paths",
          "items": {
            "type": "string",
            "description": "Project path"
          }
        },
        "activeServices": {
          "type": "object",
          "description": "Service status by project"
        },
        "lastHealthCheck": {
          "type": "string",
          "description": "Last health check timestamp"
        }
      },
      "requiredProperties": ["registryPath", "coordinatorPid", "registeredProjects"],
      "examples": [
        ".global-service-registry.json (coordinator PID, multi-project tracking)"
      ]
    }
  },
  "relationships": {
    "classifies": {
      "description": "Classification layer classifies LSL session content",
      "sourceEntityClass": "ClassificationLayer",
      "targetEntityClass": "LSLSession",
      "properties": {
        "confidence": "number",
        "processingTime": "number"
      }
    },
    "enforces": {
      "description": "Constraint rule enforces coding standards on tool calls",
      "sourceEntityClass": "ConstraintRule",
      "targetEntityClass": "ToolWrapper",
      "properties": {
        "blocking": "boolean",
        "violationCount": "number"
      }
    },
    "monitors": {
      "description": "Monitoring layer monitors service health",
      "sourceEntityClass": "MonitoringLayer",
      "targetEntityClass": "HealthFile",
      "properties": {
        "checkInterval": "number",
        "recoveryAttempts": "number"
      }
    },
    "orchestrates": {
      "description": "Workflow definition orchestrates MCP agents",
      "sourceEntityClass": "WorkflowDefinition",
      "targetEntityClass": "MCPAgent",
      "properties": {
        "stepOrder": "number",
        "dependencies": "array"
      }
    },
    "persists_to": {
      "description": "Knowledge entity persists to graph database",
      "sourceEntityClass": "KnowledgeEntity",
      "targetEntityClass": "GraphDatabase",
      "properties": {
        "timestamp": "string"
      }
    },
    "embeds_in": {
      "description": "Knowledge entity embedded in vector database",
      "sourceEntityClass": "KnowledgeEntity",
      "targetEntityClass": "VectorDatabase",
      "properties": {
        "embeddingVector": "reference to EmbeddingVector"
      }
    }
  }
}
