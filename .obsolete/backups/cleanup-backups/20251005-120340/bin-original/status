#!/usr/bin/env node

/**
 * Status Command: Show detailed system status and open dashboard
 */

import { execSync } from 'child_process';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const rootDir = join(__dirname, '..');

async function showDetailedStatus() {
  console.log('ğŸ¯ System Status Dashboard');
  console.log('â•'.repeat(50));
  
  try {
    // Get status line output
    const output = execSync('node ./scripts/combined-status-line.js', { 
      encoding: 'utf8', 
      timeout: 5000,
      cwd: rootDir
    });
    
    console.log(`\nğŸ“Š Current Status: ${output.trim()}`);
    
    // Get constraint details
    const constraintOutput = execSync('node ./integrations/mcp-constraint-monitor/src/status/constraint-status-line.js', {
      encoding: 'utf8',
      timeout: 5000,
      cwd: rootDir
    });
    
    const constraintData = JSON.parse(constraintOutput);
    
    console.log('\nğŸ›¡ï¸  CONSTRAINT MONITOR DETAILS:');
    console.log(constraintData.tooltip);
    
    // Offer to open dashboard
    console.log('\nğŸŒ Web Dashboard Available:');
    console.log('â€¢ URL: http://localhost:3001/dashboard');
    console.log('â€¢ Command: ./bin/dashboard');
    
    // Auto-open dashboard
    console.log('\nğŸš€ Opening dashboard...');
    execSync(`"${join(rootDir, 'integrations/mcp-constraint-monitor/bin/dashboard')}"`, {
      stdio: 'inherit',
      timeout: 10000,
      cwd: rootDir
    });
    
  } catch (error) {
    console.error('âŒ Failed to get status:', error.message);
    console.log('\nğŸ’¡ Try running: ./bin/dashboard');
  }
}

showDetailedStatus();