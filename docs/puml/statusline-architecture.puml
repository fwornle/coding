@startuml
!include _standard-style.puml

title StatusLine Architecture & Session Discovery

' Main entry point
component [combined-status-line.js] as CSL <<entry>>

' Core processing engine  
component [statusline-health-monitor.js] as SHM <<core>>

' Discovery methods stacked vertically
package "Session Discovery" {
  component [LSL Registry] as M1 <<discovery>>
  component [Claude Transcript Scan] as M2 <<discovery>>
  component [Health File Scan] as M3 <<discovery>>
}

' Data sources stacked vertically
package "Data Sources" {
  database [~/.claude/projects/] as Claude_Transcripts
  database [.global-lsl-registry.json] as LSL_Registry
  database [project/.health/] as Health_Files
}

' Session abbreviation engine
component [Smart Abbreviation Engine] as SAE <<logic>>

' Active sessions
package "Active Sessions" {
    component [coding â†’ C] as C_Session
    component [curriculum-alignment â†’ CA] as CA_Session  
    component [nano-degree â†’ ND] as ND_Session
}

' Output status components arranged vertically
package "Status Output" {
  component [âœ… Global Monitor] as GCM_Status
  component [C:ğŸŸ¢ CA:ğŸŸ¢ ND:ğŸŸ¢ Session Status] as ISS
  component [ğŸ›¡ï¸ Constraint Monitor] as CM_Status
  component [ğŸ” Semantic Analysis] as SA_Status
  component [ğŸ§  Memory Service] as MEM_Status
  component [ğŸ“‹ Time Window] as TW_Status
}

' Main processing flow (top to bottom)
CSL --> SHM : orchestrates

' Discovery methods flow downward
SHM --> M1 : registry lookup
SHM --> M2 : dynamic scan
SHM --> M3 : health check

' Data source connections
M1 --> LSL_Registry : reads
M2 --> Claude_Transcripts : scans
M3 --> Health_Files : checks

' Session processing flows through SAE
SHM --> SAE : process sessions
SAE --> C_Session : abbreviate
SAE --> CA_Session : abbreviate  
SAE --> ND_Session : abbreviate

' Status generation flows downward to output
SAE --> GCM_Status : global status
SAE --> ISS : session status
SHM --> CM_Status : constraint check
SHM --> SA_Status : semantic check
SHM --> MEM_Status : memory check
SHM --> TW_Status : time window

' Layout hints for vertical orientation
CSL -[hidden]down-> SHM
SHM -[hidden]down-> SAE

note top of CSL
  **StatusLine Output Example:**
  âœ…C:ğŸŸ¢ CA:ğŸŸ¢ ND:ğŸŸ¢ ğŸ›¡ï¸ 8.5 ğŸ”EX ğŸ§  âœ… ğŸ“‹9-10
end note

note right of M2
  **Discovery Process:**
  â€¢ Scan ~/.claude/projects/
  â€¢ Pattern: "-Users-*-Agentic-{project}"
  â€¢ Extract project names
  â€¢ Find active transcripts
  â€¢ No 1-hour filter (recent fix)
end note

note right of SAE
  **Abbreviation Rules:**
  â€¢ coding â†’ C
  â€¢ curriculum-alignment â†’ CA  
  â€¢ nano-degree â†’ ND
  â€¢ Handles conflicts intelligently
  â€¢ Filters dormant sessions
end note

@enduml