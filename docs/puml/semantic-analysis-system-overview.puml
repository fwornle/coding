@startuml semantic-analysis-system-overview
!theme plain
skinparam backgroundColor white
skinparam defaultFontName Arial
skinparam defaultFontSize 12

title Semantic Analysis System - Complete Architecture Overview

skinparam component {
  BackgroundColor<<api>> #E8F4FD
  BackgroundColor<<agent>> #E6F3FF
  BackgroundColor<<infra>> #FFF2E6
  BackgroundColor<<cli>> #FFE8F4
  BackgroundColor<<storage>> #FFF9E6
  BackgroundColor<<external>> #F5F5F5
  FontSize 12
  FontColor #000000
}

package "User Interfaces" {
  actor "Claude Code" as Claude <<external>>
  actor "VSCode CoPilot" as VSCode <<external>>
  actor "CLI User" as CLIUser <<external>>
}

package "MCP Integration Layer" {
  component [MCP Server] as MCP <<api>>
  component [Semantic Bridge] as Bridge <<api>>
  component [CoPilot HTTP Server] as HTTP <<api>>
  
  note right of MCP
    Port: Default MCP
    • Tool integration for Claude
    • Request routing to agents
    • Response aggregation
  end note
  
  note right of HTTP
    Port: 8765
    • REST API for VSCode
    • WebSocket notifications
    • Knowledge management
  end note
}

package "External Services" <<external>> {
  cloud [Custom LLM] as Custom
  cloud [Anthropic Claude] as Anthropic
  cloud [OpenAI GPT] as OpenAI
  cloud [Web Search APIs] as WebAPIs
  
  note right of Custom
    • Primary LLM provider
    • Custom endpoints
    • Flexible configuration
  end note
  
  note right of Anthropic
    • Secondary LLM provider
    • Content analysis
    • Insight generation
  end note
  
  note right of OpenAI
    • Fallback LLM provider
    • Provider redundancy
    • Cost optimization
  end note
}

package "Enhanced Agent System ✨" {
  package "Core Agents" {
    component [Semantic Analysis] as SemanticAgent <<agent>>
    component [Web Search] as WebAgent <<agent>>
    component [Knowledge Graph ✨] as KnowledgeAgent <<agent>>
    component [Coordinator] as CoordinatorAgent <<agent>>
  }
  
  package "Infrastructure Agents ⭐ NEW" {
    component [Synchronization ✨] as SyncAgent <<agent>>
    component [Deduplication ✨] as DedupAgent <<agent>>
    component [Documentation] as DocAgent <<agent>>
  }
}

package "Knowledge Management" {
  component [UKB-CLI] as UKB <<cli>>
  component [VKB-CLI] as VKB <<cli>>
  database "shared-memory.json" as SharedMemory <<storage>>
  cloud "MCP Memory" as MCPMemory <<external>>
}


' User connections
Claude -[#4A90E2]-> MCP : tool calls
VSCode -[#4A90E2]-> HTTP : REST API
VSCode -[#43A047,dashed]-> HTTP : WebSocket
CLIUser -[#4A90E2]-> UKB : commands
CLIUser -[#4A90E2]-> VKB : commands

' MCP layer connections (Node.js direct calls)
MCP -[#4A90E2]-> CoordinatorAgent : workflow execution
HTTP -[#FF9800]-> CoordinatorAgent : API requests
Bridge -[#43A047,dashed]-> CoordinatorAgent : semantic analysis

' Enhanced agent connections (Node.js direct calls)
CoordinatorAgent -[#FF9800]-> SemanticAgent : orchestrates
CoordinatorAgent -[#FF9800]-> WebAgent : coordinates
CoordinatorAgent -[#FF9800]-> KnowledgeAgent : manages
CoordinatorAgent -[#FF9800]-> SyncAgent : ensures consistency ✨
CoordinatorAgent -[#FF9800]-> DedupAgent : prevents duplicates ✨
CoordinatorAgent -[#FF9800]-> DocAgent : generates docs

' Enhanced knowledge connections
KnowledgeAgent -[#FF9800]-> SharedMemory : read/write
SyncAgent -[#FF9800]-> SharedMemory : bidirectional sync ✨
DedupAgent -[#FF9800]-> SharedMemory : deduplication ✨
UKB -[#FF9800]-> SharedMemory : update
VKB -[#FF9800]-> SharedMemory : read
MCPMemory -[#43A047,dashed]-> SharedMemory : sync
SyncAgent -[#43A047,dashed]-> MCPMemory : graph DB sync ✨

' Enhanced LLM connections
SemanticAgent -[#4A90E2]-> Custom : primary analysis
SemanticAgent -[#FF9800]-> Anthropic : secondary analysis
SemanticAgent -[#757575,dotted]-> OpenAI : fallback
DedupAgent -[#4A90E2]-> OpenAI : embeddings ✨
DocAgent -[#4A90E2]-> Custom : documentation ✨
WebAgent -[#43A047,dashed]-> WebAPIs : search

@enduml