@startuml
!include _standard-style.puml

title Live Session Logging (LSL) System Architecture

!define CLAUDE_COLOR #E3F2FD
!define MONITOR_COLOR #FFF3E0
!define ANALYZER_COLOR #F3E5F5
!define SESSION_COLOR #E8F5E8
!define STATUS_COLOR #FEF7E0

package "Claude Code Environment" as claude <<CLAUDE_COLOR>> {
  [Claude Code CLI] as cli
  [Tool Interactions] as tools
  [Transcript Files\n(.jsonl)] as transcript
}

package "LSL Core System" as lsl <<MONITOR_COLOR>> {
  [Transcript Monitor] as monitor
  [Live Logging Coordinator] as coordinator
  [Session Transition Logic] as transition
  [Configuration Manager] as config
}

package "Analysis Engine" as analysis <<ANALYZER_COLOR>> {
  [Semantic Analyzer] as semantic
  [XAI/Grok API] as xai
  [OpenAI API] as openai
  [Pattern Recognition] as patterns
}

package "Output Generation" as output <<SESSION_COLOR>> {
  [Session Files\n(.specstory/history/)] as sessions
  [Trajectory Files] as trajectories
  [Process Logs] as logs
}

package "User Interface" as ui <<STATUS_COLOR>> {
  [Status Line Display] as status
  [Color Coding System] as colors
  [Timing Warnings] as warnings
}

' Main data flow
cli --> tools : user interactions
tools --> transcript : JSONL format
transcript --> monitor : real-time monitoring
monitor --> coordinator : MCP integration
monitor --> transition : time boundary detection
config --> monitor : session duration\nAPI settings

' Analysis flow
monitor --> semantic : tool interactions
semantic --> xai : primary analysis
semantic --> openai : fallback analysis
semantic --> patterns : learning extraction
patterns --> trajectories : accumulated insights

' Output generation
transition --> sessions : 60-min sessions
semantic --> sessions : real-time analysis
sessions --> trajectories : pattern analysis
monitor --> logs : process logging

' Status display
sessions --> status : current session
transition --> colors : timing calculation
colors --> warnings : 5-min alerts
warnings --> status : visual indicators

' Key processes
note right of monitor : **Key Features**\nâ€¢ 5-second polling\nâ€¢ Tranche-based transitions\nâ€¢ Secret redaction\nâ€¢ Error handling

note right of semantic : **AI Analysis**\nâ€¢ Tool interaction insights\nâ€¢ Session productivity\nâ€¢ Pattern recognition\nâ€¢ Multi-provider support

note right of status : **Visual Feedback**\nâ€¢ Real-time session display\nâ€¢ ðŸŸ  5-minute warnings\nâ€¢ ðŸ”´ Session ended alerts\nâ€¢ Time remaining counter

@enduml