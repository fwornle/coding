@startuml semantic-analysis-agent-system
!include _standard-style.puml

title "14-Agent Semantic Analysis System"

top to bottom direction
skinparam linetype ortho

' Entry Layer
package "Entry" {
  [Coding Agent] <<external>> as claude
  [MCP Server\n(14 Tools)] <<api>> as mcp
}

' Orchestration
package "Orchestration" <<frame>> {
  rectangle "CoordinatorAgent" <<agent>> as coordinator {
    [Workflow Engine] <<core>>
    [Quality Loops] <<core>>
  }
}

' Phase 1: Data Collection (LLM-Powered)
package "Phase 1: Data Collection" <<frame>> {
  rectangle "GitHistoryAgent" <<agent>> as git {
    [LLM Commit Analysis] <<core>>
  }
  rectangle "VibeHistoryAgent" <<agent>> as vibe {
    [LLM Context Extraction] <<core>>
  }
}

' Phase 2: Analysis (LLM-Powered)
package "Phase 2: Semantic Analysis" <<frame>> {
  rectangle "SemanticAnalysisAgent" <<agent>> as semantic {
    [Deep Code Analysis] <<core>>
    [3-Tier LLM Chain] <<core>>
  }
  rectangle "WebSearchAgent" <<agent>> as web {
    [DuckDuckGo + LLM Ranking] <<core>>
  }
}

' Phase 3: Generation (LLM-Powered)
package "Phase 3: Knowledge Generation" <<frame>> {
  rectangle "InsightGenerationAgent" <<agent>> as insight {
    [LLM Insights + PlantUML] <<core>>
  }
  rectangle "ObservationGenerationAgent" <<agent>> as obs {
    [LLM Entity Structuring] <<core>>
  }
}

' Phase 4: Classification (LLM-Powered)
package "Phase 4: Classification & Linking" <<frame>> {
  rectangle "OntologyClassificationAgent" <<agent>> as ontology {
    [LLM Semantic Classification] <<core>>
  }
  rectangle "DocumentationLinkerAgent" <<agent>> as doclink {
    [LLM Doc-Code Matching] <<core>>
  }
  rectangle "CodeGraphAgent" <<agent>> as codegraph {
    [AST + External LLM] <<external>>
  }
}

' Phase 5: Quality & Validation (LLM-Powered)
package "Phase 5: Quality Assurance" <<frame>> {
  rectangle "QualityAssuranceAgent" <<agent>> as qa {
    [LLM Semantic Value Filter] <<core>>
    [Feedback Loops (3x)] <<core>>
  }
  rectangle "ContentValidationAgent" <<agent>> as validate {
    [LLM Staleness Detection] <<core>>
  }
}

' Phase 6: Storage
package "Phase 6: Storage & Dedup" <<frame>> {
  rectangle "PersistenceAgent" <<agent>> as persist {
    [Graphology+LevelDB] <<storage>>
  }
  rectangle "DeduplicationAgent" <<agent>> as dedup {
    [OpenAI Embeddings] <<core>>
  }
}

' External Services (compact)
package "External Services" {
  cloud "LLM Chain\n(Groq→Anthropic→OpenAI)" <<external>> as llm
  cloud "OpenAI Embeddings" <<external>> as embeddings
  database "Memgraph" <<storage>> as memgraph
  database "GraphDB" <<storage>> as graphdb
}

' Main flow connections
claude --> mcp
mcp --> coordinator

coordinator --> git
coordinator --> vibe
git --> semantic
vibe --> semantic
semantic --> web
web --> insight
semantic --> insight
semantic --> codegraph
insight --> obs
obs --> ontology
ontology --> doclink
codegraph --> doclink
doclink --> qa
qa --> persist
persist --> dedup
dedup --> validate

' LLM connections (simplified)
git ..> llm
vibe ..> llm
semantic ..> llm
web ..> llm
insight ..> llm
obs ..> llm
ontology ..> llm
doclink ..> llm
qa ..> llm
validate ..> llm
codegraph ..> llm

' Storage connections
persist --> graphdb
dedup ..> embeddings
codegraph ..> memgraph

note right of coordinator
  **Workflow Engine**
  14 agents in 6 phases
  Quality loops: up to 3 iterations
  11 agents use LLM
end note

note right of qa
  **Semantic Value Filter**
  Evaluates: Specificity,
  Actionability, Evidence,
  Uniqueness, Naming
end note

@enduml
