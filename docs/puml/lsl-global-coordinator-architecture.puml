!include _standard-style.puml

@startuml lsl-global-coordinator-architecture

title Global LSL Coordinator Architecture

package "Global LSL Coordinator System" {
  
  rectangle "Global LSL Coordinator" as GLC {
    component [Session Registry] as Registry
    component [Health Monitor] as Health
    component [Process Manager] as ProcessMgr
    component [Cleanup Service] as Cleanup
  }
  
  package "Launch Scripts" {
    [coding launcher] as CodingLauncher
    [launch-claude.sh] as LaunchScript
    [Enhanced Startup] as Startup
  }
  
  package "Monitoring Components" {
    [Enhanced Transcript Monitor] as ETM
    [ReliableCodingClassifier] as RCC
    [Session File Writer] as Writer
  }
  
  package "Session Tracking" {
    database "session-registry.json" as SessionDB {
      [Session Records] as Sessions
      [Process IDs] as PIDs
      [Health Status] as Status
      [Project Mappings] as Projects
    }
  }
  
  package "File System" {
    folder "Project A/.specstory/history" as ProjA
    folder "Project B/.specstory/history" as ProjB  
    folder "coding/.specstory/history" as CodingHist
    file "transcript-monitor.log" as Logs
  }
  
}

' Relationships
CodingLauncher --> LaunchScript : "exec launch-claude.sh"
LaunchScript --> GLC : "ensure monitoring"
GLC --> Registry : "register session"
GLC --> ProcessMgr : "start monitor"
ProcessMgr --> ETM : "spawn process"
ETM --> RCC : "classify content"
RCC --> Writer : "route content"
Writer --> ProjA : "project sessions"
Writer --> ProjB : "project sessions"  
Writer --> CodingHist : "coding sessions"

Health --> Registry : "check health"
Health --> ProcessMgr : "restart failed"
Cleanup --> Registry : "remove stale"
Registry --> SessionDB : "persist state"

ETM --> Logs : "operational logs"

note right of GLC
  **Features:**
  - Session registry and tracking
  - Health monitoring (30s intervals)
  - Automatic process recovery
  - Cross-project coordination
  - Cleanup of orphaned processes
end note

note right of SessionDB
  **Registry Contents:**
  - Active Claude sessions
  - Transcript monitor PIDs  
  - Project directory mappings
  - Health check timestamps
  - Session start times
end note

note bottom of ETM
  **Enhanced Monitor:**
  - Real-time classification
  - Content routing
  - Status line integration
  - Batch processing support
end note

@enduml