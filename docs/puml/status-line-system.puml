@startuml
!include _standard-style.puml

title Status Line System & Visual Feedback

top to bottom direction

package "Data Sources" {
  [Constraint Monitor] as constraint
  [Semantic Analysis] as semantic  
  [Live Session Files] as sessions
  [Service Status] as services
  [Redirect Status Files] as redirect
}

package "Status Line Engine" {
  [Combined Status Line] as combined
  [Time Calculation] as timing
  [Color Logic] as colors
  [Cache Manager] as cache
  [Redirect Timeout Logic] as redirect_timeout
  [Enhanced Regex Detection] as regex
}

package "Visual Output" {
  [Status Display] as display
  [Color Indicators] as indicators
  [Warning System] as warnings
}

' Data flow
constraint --> combined : Compliance score
semantic --> combined : Operational status
sessions --> combined : Current session file
services --> combined : Service health
redirect --> combined : Redirect status & timestamp
sessions --> regex : Session file names
regex --> combined : Enhanced session detection
combined --> timing : Session time range
combined --> redirect_timeout : Redirect timestamp
redirect_timeout --> combined : Dynamic flag visibility
timing --> colors : Minutes remaining
colors --> indicators : Visual coding
cache --> combined : Performance optimization

' Output generation  
indicators --> display : Final status line
warnings --> display : Alert notifications
combined --> display : Text formatting

note right of display : **Status Line Format**\nðŸ›¡ï¸ 8.5 ðŸ”EX ðŸ§  âœ… ðŸ”€â†’coding ðŸ“‹1330-1430-session\n\n**Components:**\nâ€¢ ðŸ›¡ï¸ 8.5: Constraint compliance\nâ€¢ ðŸ”EX: Experimentation mode\nâ€¢ ðŸ§  âœ…: Semantic analysis status\nâ€¢ ðŸ”€â†’coding: Dynamic redirect flag (3min timeout)\nâ€¢ ðŸ“‹: Session indicator

note right of timing : **Time Calculation**\nâ€¢ Parse session: "1330-1430"\nâ€¢ Extract end time: 14:30\nâ€¢ Calculate remaining minutes\nâ€¢ Apply color thresholds

note right of colors : **Color Logic**\n**Normal (>5 min):** ðŸ“‹1330-1430-session\n**Warning (â‰¤5 min):** ðŸ“‹ðŸŸ 1330-1430-session(3min)\n**Ended (â‰¤0 min):** ðŸ“‹ðŸ”´1330-1430-session(ended)

note right of regex : **Enhanced Regex Detection**\nHandles multiple session file patterns:\nâ€¢ 2025-09-05_1530-1630-session.md\nâ€¢ 2025-09-05_1530-1630_coding-session-from-<project>.md\nâ€¢ 2025-09-05_1530-1630-session-from-coding.md

note right of redirect_timeout : **Dynamic Redirect Flag**\nShows ðŸ”€â†’coding only when:\nâ€¢ Redirect status file exists\nâ€¢ Timestamp < 3 minutes old\nâ€¢ Automatically hides after timeout

@enduml