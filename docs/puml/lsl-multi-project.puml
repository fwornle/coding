@startuml LSL Multi-Project Architecture
!include _standard-style.puml

title LSL Multi-Project Monitoring System

!define RECTANGLE class

actor "User" as user
box "Coding Infrastructure" #LightBlue
  participant "Global LSL\nCoordinator" as glc <<infra>>
  participant "Launch Script" as launch <<util>>
end box

box "Project: <project-A>" #LightGreen
  participant "Enhanced Transcript\nMonitor (78406)" as etm1 <<core>>
  database "Claude Transcript\n.jsonl" as trans1 <<external>>
  database "Local LSL Files\n.specstory/history/" as lsl1 <<storage>>
end box

box "Project: <project-B>" #LightYellow  
  participant "Enhanced Transcript\nMonitor (78100)" as etm2 <<core>>
  database "Claude Transcript\n.jsonl" as trans2 <<external>>
  database "Local LSL Files\n.specstory/history/" as lsl2 <<storage>>
end box

box "Shared Services" #LightPink
  participant "ReliableCoding\nClassifier" as rcc <<core>>
  database "coding/.specstory/\nhistory/" as coding_lsl <<storage>>
end box

== Project Startup ==
user -> launch : coding --project <project-A>
launch -> glc : ensure monitoring
glc -> etm1 : spawn process with ENV:\nTRANSCRIPT_SOURCE_PROJECT=/path/to/<project-A>

user -> launch : coding --project <project-B>  
launch -> glc : ensure monitoring
glc -> etm2 : spawn process with ENV:\nTRANSCRIPT_SOURCE_PROJECT=/path/to/<project-B>

== Real-Time Monitoring ==
loop Every 60 seconds
  etm1 -> trans1 : monitor & refresh transcript path
  trans1 -> etm1 : new exchanges
  
  etm2 -> trans2 : monitor & refresh transcript path
  trans2 -> etm2 : new exchanges
end

== Content Classification & Routing ==
etm1 -> rcc : classify exchange content
rcc -> rcc : session continuation filter
rcc -> rcc : Layer 1: PathAnalyzer
rcc -> rcc : Layer 2: KeywordMatcher  
rcc -> rcc : Layer 3: EmbeddingClassifier
rcc -> rcc : Layer 4: SemanticAnalyzer (if needed)
alt Coding Infrastructure Content
  rcc -> etm1 : CODING_INFRASTRUCTURE
  etm1 -> coding_lsl : 2025-09-25_1800-1900_<user-hash>_from-<project-A>.md
else Project-Specific Content  
  rcc -> etm1 : NOT_CODING_INFRASTRUCTURE
  etm1 -> lsl1 : 2025-09-25_1800-1900_<user-hash>.md
end

etm2 -> rcc : classify exchange content
rcc -> rcc : session continuation filter
rcc -> rcc : Layer 1: PathAnalyzer
rcc -> rcc : Layer 2: KeywordMatcher
rcc -> rcc : Layer 3: EmbeddingClassifier
rcc -> rcc : Layer 4: SemanticAnalyzer (if needed)
alt Coding Infrastructure Content
  rcc -> etm2 : CODING_INFRASTRUCTURE
  etm2 -> coding_lsl : 2025-09-25_1900-2000_<user-hash>_from-<project-B>.md
else Project-Specific Content
  rcc -> etm2 : NOT_CODING_INFRASTRUCTURE  
  etm2 -> lsl2 : 2025-09-25_1900-2000_<user-hash>.md
end

== Health Monitoring ==
loop Every 30 seconds
  glc -> etm1 : check health file
  etm1 -> glc : process metrics & activity
  glc -> etm2 : check health file
  etm2 -> glc : process metrics & activity
  
  note over glc
    Health Check Results:
    - <project-A>: 11 exchanges, healthy
    - <project-B>: 18 exchanges, healthy
  end note
end

note over user, coding_lsl
  **Key Benefits:**
  • Each project monitors its own Claude transcript
  • Independent health monitoring & recovery
  • Smart content routing prevents false redirections
  • Zero data loss through robust process management
end note

@enduml
