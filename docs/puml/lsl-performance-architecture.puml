@startuml lsl-performance-architecture
!include _standard-style.puml

title LSL Performance Architecture

package "Performance Modes" {
  
  rectangle "Live Mode" as live <<core>> {
    [Real-time Classification] as realtime
    [Status Line Updates] as statusline
    [Session File Streaming] as streaming
    
    note as live_note
    **Live Mode:**
    • <10ms classification target
    • Real-time feedback
    • Streaming file updates
    • Full three-layer analysis
    end note
  }
  
  rectangle "Batch Mode" as batch <<util>> {
    [Fast-Path Classification] as fastpath
    [Parallel Processing] as parallel
    [Bulk File Generation] as bulkgen
    
    note as batch_note
    **Batch Mode:**
    • Skip semantic analysis
    • 5 files processed in parallel  
    • Keyword + Path detection only
    • 200x performance improvement
    end note
  }
}

package "Classification Performance" {
  [PathAnalyzer] as path_perf <<core>>
  [KeywordMatcher] as keyword_perf <<core>>
  [SemanticAnalyzer] as semantic_perf <<api>>
  
  note right of path_perf
    <1ms response time
    100% accuracy for file ops
  end note
  
  note right of keyword_perf
    <2ms response time  
    Dictionary-based matching
    High precision/recall
  end note
  
  note right of semantic_perf
    <2000ms response time
    LLM-powered analysis
    Highest accuracy
  end note
}

package "Data Processing" {
  database "Transcript Files\n(~/.claude/projects/)" as transcripts_perf
  [Exchange Extraction] as extraction
  [Content Filtering] as filtering
  [Session Grouping] as grouping
  
  note right of extraction
    JSON line parsing
    Message content extraction
    Tool call analysis
  end note
  
  note right of filtering
    Remove /sl commands
    Skip empty messages
    Filter system messages
  end note
  
  note right of grouping
    Time window organization
    Cross-project routing
    Session file generation
  end note
}

' Performance flow - Live Mode
realtime --> path_perf : Layer 1
realtime --> keyword_perf : Layer 2
realtime --> semantic_perf : Layer 3 (if needed)
realtime --> statusline : update indicators
realtime --> streaming : append session files

' Performance flow - Batch Mode  
fastpath --> path_perf : Layer 1 only
fastpath --> keyword_perf : Layer 2 only
fastpath -.-> semantic_perf : bypassed
parallel --> fastpath : 5 parallel workers
parallel --> bulkgen : bulk session creation

' Data processing flow
transcripts_perf --> extraction : read .jsonl files
extraction --> filtering : clean content
filtering --> grouping : organize by time
grouping --> bulkgen : generate session files

' Performance metrics
note bottom of batch
**Batch Performance Results:**
• Before: 12+ minutes (120 files)
• After: ~5 seconds (120 files)  
• Speed improvement: 200x
• Files processed: 120
• Exchanges classified: 2,130
• Session files created: 47
end note

note bottom of live
**Live Performance Targets:**
• Classification: <10ms
• Status update: <5ms
• File append: <2ms
• Total overhead: <20ms per exchange
end note

@enduml