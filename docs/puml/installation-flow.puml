@startuml installation-flow
!include _standard-style.puml

title Safe Installation with Confirmation Prompts

start

partition "Dependency Check with Confirmation" {
  :Check System Dependencies;
  note right: Git, Node.js, npm, Python3, jq

  while (Missing dependency?) is (yes)
    :Display Confirmation Prompt;
    note right
      Shows action and risk
      Options: y/N/skip-all
    end note

    if (User response?) then (y - approve)
      :Install dependency;
      if (Install successful?) then (yes)
        #lightgreen:Dependency installed;
      else (no)
        #orange:Warning: Install failed;
      endif
    elseif (skip-all) then
      #lightblue:SKIP_ALL_SYSTEM_CHANGES = true;
      :Skip remaining system changes;
      break
    else (N - skip)
      #lightgray:Skip this dependency;
      :Add to skipped list;
    endif
  endwhile (no)
}

:Network Detection;
note right
  Test SSH access to cc-github.bmwgroup.net
  Fallback: HTTPS curl test
end note

if (cc-github.bmwgroup.net accessible?) then (yes)
  :Inside Corporate Network (CN);
  #lightblue:Set INSIDE_CN = true;

  :Test Proxy Connectivity;

  if (Proxy working?) then (yes)
    #lightgreen:PROXY_WORKING = true;
  else (no)
    #orange:PROXY_WORKING = false;
  endif

  :Select CN Repository Strategy;

else (no)
  :Outside Corporate Network;
  #lightgray:Set INSIDE_CN = false;
  #lightgreen:PROXY_WORKING = true;

  :Select Public Repository Strategy;
endif

partition "Install Submodule Components" {
  :Install Memory Visualizer;
  :Install Browserbase;
  :Install Semantic Analysis;
  :Install Serena;
  :Install Constraint Monitor;
}

partition "Shell Configuration (with Backup)" {
  :Detect shell config file;
  note right: .bashrc, .zshrc, .bash_profile

  :Create timestamped backup;
  note right
    Backup: .zshrc.coding-backup.YYYYMMDDHHMMSS
  end note

  :Display Confirmation Prompt;
  note right
    Modify shell configuration?
    Shows what will be added
  end note

  if (User approves?) then (yes)
    :Add coding tools section;
    note right
      CODING TOOLS START marker
      export CODING_REPO=...
      export PATH=...
      CODING TOOLS END marker
    end note

    :Verify syntax;
    if (Syntax valid?) then (yes)
      #lightgreen:Shell config updated;
    else (no)
      :Restore from backup;
      #red:Shell config error;
    endif
  else (no)
    #lightgray:Shell config unchanged;
    note right: Manual setup required
  endif
}

:Build MCP Servers;

:Generate Installation Report;

if (Any skipped changes?) then (yes)
  #lightblue:Show skipped system changes;
  note right
    Lists dependencies user chose to skip
    Provides manual install commands
  end note
endif

if (Any failures?) then (yes)
  #red:**Installation completed with failures**;
else (no)
  if (Any warnings?) then (yes)
    #orange:**Installation completed with warnings**;
  else (no)
    #lightgreen:**Installation completed successfully**;
  endif
endif

:Create .activate script;

stop

@enduml