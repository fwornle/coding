!include _standard-style.puml

@startuml lsl-batch-mode-workflows

title LSL Batch Mode Processing Workflows

package "Batch Mode Use Cases" {

  ' Standard Batch Processing
  rectangle "Standard Batch Processing" as StandardBatch {
    component [Generate LSL for specific project] as GenLSL
    component [Process all historical transcripts] as ProcessAll
    component [Fast-path classification] as FastPath
    
    GenLSL --> ProcessAll : "scan ~/.claude/projects/"
    ProcessAll --> FastPath : "skip semantic analysis"
  }

  ' Foreign Mode Processing  
  rectangle "Foreign Mode Processing" as ForeignMode {
    component [Scan other project transcripts] as ScanOther
    component [Extract coding-related content] as ExtractCoding
    component [Route to coding project] as RouteToCoding
    
    ScanOther --> ExtractCoding : "classify each exchange"
    ExtractCoding --> RouteToCoding : "coding infrastructure only"
  }

  ' Local Mode Processing
  rectangle "Local Mode Processing" as LocalMode {
    component [Process project's own transcripts] as ProcessOwn
    component [Include all content] as IncludeAll
    component [Generate native sessions] as GenNative
    
    ProcessOwn --> IncludeAll : "no filtering"
    IncludeAll --> GenNative : "complete conversations"
  }

  ' Parallel Processing
  rectangle "Parallel Processing Architecture" as Parallel {
    component [Transcript File Queue] as Queue
    component [Worker Pool (5 concurrent)] as Workers
    component [Classification Engine] as Classifier
    component [Output Aggregator] as Aggregator
    
    Queue --> Workers : "batch of 5 files"
    Workers --> Classifier : "process exchanges"
    Classifier --> Aggregator : "classified results"
  }

}

package "Command Examples" {
  note as Commands
    **Local Mode (nano-degree project):**
    ```bash
    node scripts/generate-proper-lsl-from-transcripts.js \\
      --mode=local --parallel
    ```
    
    **Foreign Mode (coding infrastructure):**
    ```bash  
    node scripts/generate-proper-lsl-from-transcripts.js \\
      --mode=foreign --parallel
    ```
    
    **Legacy Single Project:**
    ```bash
    CODING_TARGET_PROJECT="/path/to/project" \\
      node scripts/generate-proper-lsl-from-transcripts.js
    ```
    
    **Fast Processing with Timeout:**
    ```bash
    timeout 30s node scripts/generate-proper-lsl-from-transcripts.js \\
      --mode=local --parallel
    ```
  end note
}

package "Performance Optimizations" {
  rectangle "Fast-Path Classification" as FastPathDetail {
    component [Skip Semantic Analysis] as SkipSemantic
    component [Use Only Path + Keywords] as PathKeywords
    component [Parallel File Processing] as ParallelFiles
    component [Batch Exchange Processing] as BatchExchange
    
    SkipSemantic --> PathKeywords : "layer 1 & 2 only"
    PathKeywords --> ParallelFiles : "5 concurrent workers"
    ParallelFiles --> BatchExchange : "optimize I/O"
  }
}

' Relationships between use cases
StandardBatch --> LocalMode : "typical workflow"
StandardBatch --> ForeignMode : "cross-project content"
LocalMode --> Parallel : "uses parallel processing"
ForeignMode --> Parallel : "uses parallel processing"
Parallel --> FastPathDetail : "implements optimizations"

note right of StandardBatch
  **Generated Files:**
  - YYYY-MM-DD_HHMM-HHMM-session.md
  - Time-window organized
  - Complete conversations
end note

note right of ForeignMode
  **Cross-project Files:**
  - YYYY-MM-DD_HHMM-HHMM-session-from-PROJECT.md  
  - Only coding infrastructure content
  - Proper attribution
end note

note right of LocalMode
  **Native Sessions:**
  - All content included
  - No filtering applied
  - Full conversation context
end note

@enduml