@startuml Knowledge Flow Architecture
!define RECTANGLE class

title Knowledge Flow: Project → MCP Memory → Git Storage

actor Developer
participant "ukb Script" as UKB
participant "Temp Files" as TEMP
participant "Claude Code" as CLAUDE
participant "MCP Memory" as MCP
participant "shared-memory.json" as JSON
participant "Git Repository" as GIT

== Phase 1: Insight Capture ==

Developer -> UKB: ukb --interactive
note right: Captures deep insights\nand architectural decisions

UKB -> UKB: Parse git commits
UKB -> UKB: Analyze file changes
UKB -> UKB: Prompt for insights

UKB -> TEMP: Create insight files
note right: JSON format with\nentities and observations

== Phase 2: MCP Integration ==

UKB -> UKB: Generate MCP operations
UKB -> TEMP: Create mcp_sync_operations.md

UKB -> CLAUDE: Request MCP sync
note right: Provides structured\ndata for MCP operations

CLAUDE -> MCP: mcp__memory__create_entities
CLAUDE -> MCP: mcp__memory__create_relations  
CLAUDE -> MCP: mcp__memory__add_observations

MCP -> MCP: Build knowledge graph
MCP -> MCP: Create bidirectional relations

== Phase 3: Persistent Storage ==

CLAUDE -> MCP: mcp__memory__read_graph
MCP -> CLAUDE: Complete knowledge state

CLAUDE -> JSON: Update shared-memory.json
note right: Serialize MCP state\nto JSON format

JSON -> GIT: Git commit
note right: Version-controlled\nknowledge evolution

== Cross-Session Access ==

Developer -> CLAUDE: New session
CLAUDE -> JSON: Load knowledge base
CLAUDE -> MCP: Restore MCP state
note right: Bidirectional sync\nensures consistency

== Knowledge Sharing ==

GIT -> GIT: Git push/pull
note right: Team knowledge\nsharing via git

Developer -> UKB: vkb (visualize)
UKB -> JSON: Read knowledge graph
UKB -> Developer: Web visualization
note right: Interactive knowledge\nexploration at localhost:8080

@enduml