@startuml process-monitoring-architecture
!include _standard-style.puml

' Presentation overrides - larger fonts and white background
skinparam backgroundColor white
skinparam defaultFontSize 16
skinparam titleFontSize 22
skinparam component {
  BorderThickness 2
  FontSize 14
}
skinparam package {
  BorderThickness 2
  FontSize 16
  FontStyle bold
}
skinparam arrow {
  Thickness 2
  FontSize 12
}
skinparam database {
  BorderThickness 2
  FontSize 14
}
skinparam note {
  FontSize 11
}

title Process Monitoring Architecture

top to bottom direction

package "Session Management" #E8F5E9 {
  component [launch-claude.sh] as LaunchClaude <<cli>>
  component [Session Cleanup] as Cleanup <<util>>
}

package "Service Management Layer" #E3F2FD {
  component [Global Service\nCoordinator] as Coordinator <<core>>
  component [start-services.sh] as StartScript <<cli>>
}

package "Process State Manager (PSM)" #FFF9C4 {
  component [Process Registry\n.live-process-registry.json] as PSM_Registry <<storage>>
  component [Lock Manager\n(proper-lockfile)] as Lock <<util>>

  PSM_Registry -down-> Lock : atomic operations
}

package "Monitoring Layer" #FFECB3 {
  component [System Monitor\nWatchdog] as Watchdog <<infra>>
  component [Monitoring\nVerifier] as Verifier <<infra>>
}

package "Running Services" #E1F5FE {
  component [Constraint\nDashboard] as Dashboard <<api>>
  component [Enhanced\nTranscript Monitor] as TranscriptMon <<core>>
  component [VKB Server] as VKB <<api>>
}

' Connections from top to center
LaunchClaude -down-> PSM_Registry : register session
Cleanup -down-> PSM_Registry : cleanup session services
Coordinator -down-> PSM_Registry : register/query/unregister
StartScript -down-> PSM_Registry : register services

' Connections from center to bottom
Watchdog -up-> PSM_Registry : check coordinator health
Verifier -up-> PSM_Registry : verify system health

' Service management
Dashboard -up-> Coordinator : managed by
TranscriptMon -up-> Coordinator : managed by
VKB -up-> StartScript : started by

@enduml
