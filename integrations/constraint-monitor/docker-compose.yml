version: '3.8'

services:
  qdrant:
    image: qdrant/qdrant:v1.7.0
    container_name: constraint-monitor-qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - ./data/qdrant:/qdrant/storage
    environment:
      QDRANT__SERVICE__MAX_REQUEST_SIZE_MB: 64
      QDRANT__SERVICE__GRPC_PORT: 6334
    restart: unless-stopped
    
  redis:
    image: redis:7-alpine
    container_name: constraint-monitor-redis
    ports:
      - "6379:6379"
    volumes:
      - ./data/redis:/data
    command: redis-server --maxmemory 256mb --maxmemory-policy allkeys-lru --save 60 1000
    restart: unless-stopped

  # Optional: Redis insight for monitoring
  redis-insight:
    image: redislabs/redisinsight:latest
    container_name: constraint-monitor-redis-insight
    ports:
      - "8001:8001"
    depends_on:
      - redis
    restart: unless-stopped
    profiles: ["monitoring"]

networks:
  default:
    name: constraint-monitor-network